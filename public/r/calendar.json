{
  "name": "calendar",
  "type": "registry:ui",
  "title": "Calendar",
  "description": "Month grid calendar with keyboard navigation and date selection.",
  "registryDependencies": [
    "tokens"
  ],
  "files": [
    {
      "path": "components/ui/calendar.tsx",
      "content": "import * as React from \"react\"\nimport {\n  Platform,\n  Pressable,\n  type PressableProps,\n  Text,\n  View,\n  type ViewProps,\n} from \"react-native\"\nimport { StyleSheet } from \"react-native-unistyles\"\n\ntype CalendarDay = {\n  date: Date\n  outside: boolean\n}\n\ntype WeekdayFormat = \"short\" | \"long\" | \"narrow\"\n\nexport type CalendarProps = ViewProps & {\n  value?: Date\n  defaultValue?: Date\n  onValueChange?: (date?: Date) => void\n  month?: Date\n  defaultMonth?: Date\n  onMonthChange?: (month: Date) => void\n  locale?: string | string[]\n  weekStartsOn?: 0 | 1 | 2 | 3 | 4 | 5 | 6\n  showOutsideDays?: boolean\n  disabled?: boolean\n  minDate?: Date\n  maxDate?: Date\n  disabledDates?: (date: Date) => boolean\n  weekdayFormat?: WeekdayFormat\n}\n\nfunction startOfDay(date: Date) {\n  const next = new Date(date)\n  next.setHours(0, 0, 0, 0)\n  return next\n}\n\nfunction startOfMonth(date: Date) {\n  const next = startOfDay(date)\n  next.setDate(1)\n  return next\n}\n\nfunction addDays(date: Date, amount: number) {\n  const next = new Date(date)\n  next.setDate(next.getDate() + amount)\n  return next\n}\n\nfunction addMonths(date: Date, amount: number) {\n  const next = new Date(date)\n  const dayOfMonth = next.getDate()\n  next.setDate(1)\n  next.setMonth(next.getMonth() + amount)\n  const daysInMonth = new Date(\n    next.getFullYear(),\n    next.getMonth() + 1,\n    0,\n  ).getDate()\n  next.setDate(Math.min(dayOfMonth, daysInMonth))\n  return next\n}\n\nfunction addYears(date: Date, amount: number) {\n  const next = new Date(date)\n  next.setFullYear(next.getFullYear() + amount)\n  return next\n}\n\nfunction isSameDay(left: Date, right: Date) {\n  return (\n    left.getFullYear() === right.getFullYear() &&\n    left.getMonth() === right.getMonth() &&\n    left.getDate() === right.getDate()\n  )\n}\n\nfunction isSameMonth(left: Date, right: Date) {\n  return (\n    left.getFullYear() === right.getFullYear() &&\n    left.getMonth() === right.getMonth()\n  )\n}\n\nfunction clampDate(date: Date, minDate?: Date, maxDate?: Date) {\n  const day = startOfDay(date)\n  if (minDate && day < startOfDay(minDate)) {\n    return startOfDay(minDate)\n  }\n  if (maxDate && day > startOfDay(maxDate)) {\n    return startOfDay(maxDate)\n  }\n  return day\n}\n\nfunction getWeekStart(date: Date, weekStartsOn: number) {\n  const day = date.getDay()\n  const diff = (day - weekStartsOn + 7) % 7\n  return addDays(date, -diff)\n}\n\nfunction getWeekEnd(date: Date, weekStartsOn: number) {\n  return addDays(getWeekStart(date, weekStartsOn), 6)\n}\n\nfunction getCalendarDays(month: Date, weekStartsOn: number) {\n  const start = startOfMonth(month)\n  const startOffset = (start.getDay() - weekStartsOn + 7) % 7\n  const gridStart = addDays(start, -startOffset)\n\n  const days: CalendarDay[] = []\n  for (let i = 0; i < 42; i += 1) {\n    const date = addDays(gridStart, i)\n    days.push({ date, outside: !isSameMonth(date, start) })\n  }\n\n  const weeks: CalendarDay[][] = []\n  for (let i = 0; i < days.length; i += 7) {\n    weeks.push(days.slice(i, i + 7))\n  }\n  return weeks\n}\n\nexport const Calendar = React.forwardRef<View, CalendarProps>(\n  (\n    {\n      value: valueProp,\n      defaultValue,\n      onValueChange,\n      month: monthProp,\n      defaultMonth,\n      onMonthChange,\n      locale,\n      weekStartsOn = 0,\n      showOutsideDays = true,\n      disabled = false,\n      minDate,\n      maxDate,\n      disabledDates,\n      weekdayFormat = \"short\",\n      style,\n      ...props\n    },\n    ref,\n  ) => {\n    const [uncontrolledValue, setUncontrolledValue] = React.useState<\n      Date | undefined\n    >(valueProp ?? defaultValue)\n    const isValueControlled = valueProp !== undefined\n    const selectedDate = isValueControlled ? valueProp : uncontrolledValue\n\n    const initialMonth = React.useMemo(() => {\n      const base = monthProp ?? defaultMonth ?? selectedDate ?? new Date()\n      return startOfMonth(base)\n    }, [defaultMonth, monthProp, selectedDate])\n\n    const [uncontrolledMonth, setUncontrolledMonth] =\n      React.useState<Date>(initialMonth)\n    const isMonthControlled = monthProp !== undefined\n    const currentMonth = startOfMonth(isMonthControlled ? monthProp : uncontrolledMonth)\n\n    const [focusedDate, setFocusedDate] = React.useState<Date>(() => {\n      return startOfDay(selectedDate ?? currentMonth)\n    })\n\n    const dayRefs = React.useRef<Map<string, View | null>>(new Map())\n\n    const isDateDisabled = React.useCallback(\n      (date: Date) => {\n        if (disabled) return true\n        const day = startOfDay(date)\n        if (minDate && day < startOfDay(minDate)) return true\n        if (maxDate && day > startOfDay(maxDate)) return true\n        return disabledDates?.(day) ?? false\n      },\n      [disabled, disabledDates, maxDate, minDate],\n    )\n\n    const handleValueChange = React.useCallback(\n      (date?: Date) => {\n        if (!isValueControlled) {\n          setUncontrolledValue(date)\n        }\n        onValueChange?.(date)\n      },\n      [isValueControlled, onValueChange],\n    )\n\n    const handleMonthChange = React.useCallback(\n      (nextMonth: Date) => {\n        const normalized = startOfMonth(nextMonth)\n        if (!isMonthControlled) {\n          setUncontrolledMonth(normalized)\n        }\n        onMonthChange?.(normalized)\n      },\n      [isMonthControlled, onMonthChange],\n    )\n\n    React.useEffect(() => {\n      if (!isMonthControlled && selectedDate) {\n        if (!isSameMonth(selectedDate, currentMonth)) {\n          handleMonthChange(selectedDate)\n        }\n      }\n    }, [currentMonth, handleMonthChange, isMonthControlled, selectedDate])\n\n    React.useEffect(() => {\n      if (selectedDate) {\n        setFocusedDate(startOfDay(selectedDate))\n      }\n    }, [selectedDate])\n\n    React.useEffect(() => {\n      if (!isSameMonth(focusedDate, currentMonth)) {\n        setFocusedDate(startOfDay(currentMonth))\n      }\n    }, [currentMonth, focusedDate])\n\n    const monthLabel = React.useMemo(() => {\n      const formatter = new Intl.DateTimeFormat(locale, {\n        month: \"long\",\n        year: \"numeric\",\n      })\n      return formatter.format(currentMonth)\n    }, [currentMonth, locale])\n\n    const weekdayLabels = React.useMemo(() => {\n      const formatter = new Intl.DateTimeFormat(locale, {\n        weekday: weekdayFormat,\n      })\n      const base = new Date(2021, 7, 1)\n      return Array.from({ length: 7 }, (_, index) => {\n        return formatter.format(addDays(base, (weekStartsOn + index) % 7))\n      })\n    }, [locale, weekStartsOn, weekdayFormat])\n\n    const dayLabelFormatter = React.useMemo(() => {\n      return new Intl.DateTimeFormat(locale, {\n        weekday: \"long\",\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n      })\n    }, [locale])\n\n    const weeks = React.useMemo(\n      () => getCalendarDays(currentMonth, weekStartsOn),\n      [currentMonth, weekStartsOn],\n    )\n\n    const setDayRef = React.useCallback((key: string) => {\n      return (node: View | null) => {\n        if (node) {\n          dayRefs.current.set(key, node)\n        } else {\n          dayRefs.current.delete(key)\n        }\n      }\n    }, [])\n\n    const focusDate = React.useCallback(\n      (date: Date) => {\n        const next = clampDate(date, minDate, maxDate)\n        setFocusedDate(next)\n        if (!isSameMonth(next, currentMonth)) {\n          handleMonthChange(next)\n        }\n      },\n      [currentMonth, handleMonthChange, maxDate, minDate],\n    )\n\n    React.useEffect(() => {\n      if (Platform.OS !== \"web\") return\n      const key = formatDateKey(focusedDate)\n      const node = dayRefs.current.get(key)\n      if (node && typeof (node as { focus?: () => void }).focus === \"function\") {\n        requestAnimationFrame(() => {\n          ;(node as { focus?: () => void }).focus?.()\n        })\n      }\n    }, [focusedDate])\n\n    const handleSelectDate = React.useCallback(\n      (date: Date) => {\n        if (isDateDisabled(date)) return\n        handleValueChange(startOfDay(date))\n        focusDate(date)\n      },\n      [focusDate, handleValueChange, isDateDisabled],\n    )\n\n    const handleDayKeyDown = React.useCallback(\n      // biome-ignore lint/suspicious/noExplicitAny: Web-only keyboard event type\n      (event: any, date: Date) => {\n        if (Platform.OS !== \"web\") return\n        if (disabled) return\n\n        let nextDate: Date | null = null\n\n        switch (event.key) {\n          case \"ArrowLeft\":\n            nextDate = addDays(date, -1)\n            break\n          case \"ArrowRight\":\n            nextDate = addDays(date, 1)\n            break\n          case \"ArrowUp\":\n            nextDate = addDays(date, -7)\n            break\n          case \"ArrowDown\":\n            nextDate = addDays(date, 7)\n            break\n          case \"Home\":\n            nextDate = getWeekStart(date, weekStartsOn)\n            break\n          case \"End\":\n            nextDate = getWeekEnd(date, weekStartsOn)\n            break\n          case \"PageUp\":\n            nextDate = event.shiftKey ? addYears(date, -1) : addMonths(date, -1)\n            break\n          case \"PageDown\":\n            nextDate = event.shiftKey ? addYears(date, 1) : addMonths(date, 1)\n            break\n          case \"Enter\":\n          case \" \":\n            event.preventDefault()\n            handleSelectDate(date)\n            return\n          default:\n            return\n        }\n\n        if (nextDate) {\n          event.preventDefault()\n          focusDate(nextDate)\n        }\n      },\n      [disabled, focusDate, handleSelectDate, weekStartsOn],\n    )\n\n    const handlePrevMonth = React.useCallback(() => {\n      focusDate(addMonths(currentMonth, -1))\n    }, [currentMonth, focusDate])\n\n    const handleNextMonth = React.useCallback(() => {\n      focusDate(addMonths(currentMonth, 1))\n    }, [currentMonth, focusDate])\n\n    return (\n      <View ref={ref} style={[styles.container, style]} {...props}>\n        <View style={styles.header}>\n          <CalendarNavButton\n            accessibilityLabel=\"Previous month\"\n            onPress={handlePrevMonth}\n            disabled={disabled}\n          >\n            <Text style={styles.navIcon}>{\"<\"}</Text>\n          </CalendarNavButton>\n          <Text style={styles.headerLabel}>{monthLabel}</Text>\n          <CalendarNavButton\n            accessibilityLabel=\"Next month\"\n            onPress={handleNextMonth}\n            disabled={disabled}\n          >\n            <Text style={styles.navIcon}>{\">\"}</Text>\n          </CalendarNavButton>\n        </View>\n        <View style={styles.weekdayRow}>\n          {weekdayLabels.map((label) => (\n            <Text key={label} style={styles.weekdayText}>\n              {label}\n            </Text>\n          ))}\n        </View>\n        <View style={styles.weeks}>\n          {weeks.map((week) => (\n            <View key={`week-${formatDateKey(week[0].date)}`} style={styles.weekRow}>\n              {week.map((day) => {\n                const isOutside = day.outside\n                const isSelected =\n                  selectedDate !== undefined &&\n                  isSameDay(day.date, selectedDate)\n                const isToday = isSameDay(day.date, new Date())\n                const isDayDisabled = isDateDisabled(day.date)\n                const isFocused = isSameDay(day.date, focusedDate)\n                const dayKey = formatDateKey(day.date)\n                const dayLabel = dayLabelFormatter.format(day.date)\n\n                return (\n                  <CalendarDayButton\n                    key={dayKey}\n                    date={day.date}\n                    label={day.date.getDate()}\n                    ariaLabel={dayLabel}\n                    outside={isOutside}\n                    showOutsideDays={showOutsideDays}\n                    selected={isSelected}\n                    today={isToday}\n                    disabled={isDayDisabled}\n                    focused={isFocused}\n                    setDayRef={setDayRef(dayKey)}\n                    onSelect={handleSelectDate}\n                    onFocusDate={focusDate}\n                    onKeyDown={handleDayKeyDown}\n                  />\n                )\n              })}\n            </View>\n          ))}\n        </View>\n      </View>\n    )\n  },\n)\n\nCalendar.displayName = \"Calendar\"\n\ntype CalendarDayButtonProps = Omit<PressableProps, \"onPress\"> & {\n  date: Date\n  label: number\n  ariaLabel: string\n  outside: boolean\n  showOutsideDays: boolean\n  selected: boolean\n  today: boolean\n  disabled: boolean\n  focused: boolean\n  setDayRef: (node: View | null) => void\n  onSelect: (date: Date) => void\n  onFocusDate: (date: Date) => void\n  onKeyDown: (event: unknown, date: Date) => void\n}\n\nfunction CalendarDayButton({\n  date,\n  label,\n  ariaLabel,\n  outside,\n  showOutsideDays,\n  selected,\n  today,\n  disabled,\n  focused,\n  setDayRef,\n  onSelect,\n  onFocusDate,\n  onKeyDown,\n  style,\n  ...props\n}: CalendarDayButtonProps) {\n  const variantStyles = styles.useVariants({\n    selected,\n    today,\n    outside,\n    disabled,\n    focused,\n  })\n\n  const textStyle = [\n    styles.dayText,\n    selected && styles.dayTextSelected,\n    today && styles.dayTextToday,\n    outside && styles.dayTextOutside,\n    disabled && styles.dayTextDisabled,\n  ]\n\n  const handlePress = React.useCallback(() => {\n    if (disabled) return\n    onSelect(date)\n  }, [date, disabled, onSelect])\n\n  const handleFocus = React.useCallback(() => {\n    if (disabled) return\n    onFocusDate(date)\n  }, [date, disabled, onFocusDate])\n\n  if (!showOutsideDays && outside) {\n    return <View style={styles.dayPlaceholder} />\n  }\n\n  return (\n    <Pressable\n      ref={setDayRef}\n      // @ts-expect-error - web-only role\n      role={Platform.OS === \"web\" ? \"gridcell\" : undefined}\n      aria-label={Platform.OS === \"web\" ? ariaLabel : undefined}\n      aria-selected={Platform.OS === \"web\" ? selected : undefined}\n      aria-disabled={Platform.OS === \"web\" ? disabled : undefined}\n      accessibilityRole=\"button\"\n      accessibilityState={{ selected, disabled }}\n      disabled={disabled}\n      focusable={!disabled}\n      onPress={handlePress}\n      onFocus={handleFocus}\n      onKeyDown={Platform.OS === \"web\" ? (event: unknown) => onKeyDown(event, date) : undefined}\n      tabIndex={Platform.OS === \"web\" ? (focused ? 0 : -1) : undefined}\n      style={({ pressed }) =>\n        [\n          styles.dayButton,\n          variantStyles,\n          pressed && !disabled && styles.dayPressed,\n          typeof style === \"function\" ? style({ pressed }) : style,\n          // biome-ignore lint/suspicious/noExplicitAny: Complex style array with variants requires type assertion\n        ] as any\n      }\n      {...props}\n    >\n      <Text style={textStyle}>{label}</Text>\n    </Pressable>\n  )\n}\n\nfunction formatDateKey(date: Date) {\n  const year = date.getFullYear()\n  const month = String(date.getMonth() + 1).padStart(2, \"0\")\n  const day = String(date.getDate()).padStart(2, \"0\")\n  return `${year}-${month}-${day}`\n}\n\ntype CalendarNavButtonProps = PressableProps & {\n  children: React.ReactNode\n}\n\nfunction CalendarNavButton({\n  children,\n  disabled,\n  style,\n  ...props\n}: CalendarNavButtonProps) {\n  const variantStyles = styles.useVariants({\n    disabled: !!disabled,\n  })\n\n  return (\n    <Pressable\n      role={Platform.OS === \"web\" ? \"button\" : undefined}\n      accessibilityRole=\"button\"\n      accessibilityState={{ disabled: !!disabled }}\n      disabled={disabled}\n      style={({ pressed }) =>\n        [\n          styles.navButton,\n          variantStyles,\n          pressed && !disabled && styles.navButtonPressed,\n          typeof style === \"function\" ? style({ pressed }) : style,\n          // biome-ignore lint/suspicious/noExplicitAny: Complex style array with variants requires type assertion\n        ] as any\n      }\n      {...props}\n    >\n      {children}\n    </Pressable>\n  )\n}\n\nconst styles = StyleSheet.create((theme) => ({\n  container: {\n    borderRadius: theme.radius.md,\n    borderWidth: 1,\n    borderColor: theme.colors.border,\n    backgroundColor: theme.colors.popover,\n  },\n  header: {\n    paddingHorizontal: theme.spacing[2],\n    paddingVertical: theme.spacing[2],\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  headerLabel: {\n    fontSize: theme.typography.sizes.sm,\n    lineHeight: theme.typography.lineHeights.sm,\n    fontWeight: theme.typography.weights.semibold,\n    color: theme.colors.foreground,\n  },\n  navButton: {\n    width: theme.spacing[8],\n    height: theme.spacing[8],\n    borderRadius: theme.radius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    variants: {\n      disabled: {\n        true: {\n          opacity: 0.5,\n        },\n      },\n    },\n  },\n  navButtonPressed: {\n    backgroundColor: theme.colors.muted,\n  },\n  navIcon: {\n    fontSize: theme.typography.sizes.md,\n    color: theme.colors.foreground,\n  },\n  weekdayRow: {\n    flexDirection: \"row\",\n    paddingHorizontal: theme.spacing[2],\n    paddingBottom: theme.spacing[1],\n  },\n  weekdayText: {\n    flex: 1,\n    textAlign: \"center\",\n    fontSize: theme.typography.sizes.xs,\n    lineHeight: theme.typography.lineHeights.xs,\n    color: theme.colors.mutedForeground,\n  },\n  weeks: {\n    gap: theme.spacing[1],\n    paddingHorizontal: theme.spacing[2],\n    paddingBottom: theme.spacing[2],\n  },\n  weekRow: {\n    flexDirection: \"row\",\n    gap: theme.spacing[1],\n  },\n  dayPlaceholder: {\n    flex: 1,\n    height: theme.spacing[8],\n  },\n  dayButton: {\n    flex: 1,\n    height: theme.spacing[8],\n    borderRadius: theme.radius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    variants: {\n      selected: {\n        true: {\n          backgroundColor: theme.colors.primary,\n        },\n      },\n      today: {\n        true: {\n          borderWidth: 1,\n          borderColor: theme.colors.ring,\n        },\n      },\n      outside: {\n        true: {\n          opacity: 0.6,\n        },\n      },\n      disabled: {\n        true: {\n          opacity: 0.4,\n        },\n      },\n      focused: {\n        true: {\n          borderWidth: 2,\n          borderColor: theme.colors.ring,\n        },\n      },\n    },\n  },\n  dayPressed: {\n    backgroundColor: theme.colors.muted,\n  },\n  dayText: {\n    fontSize: theme.typography.sizes.sm,\n    lineHeight: theme.typography.lineHeights.sm,\n    color: theme.colors.foreground,\n  },\n  dayTextSelected: {\n    color: theme.colors.primaryForeground,\n  },\n  dayTextOutside: {\n    color: theme.colors.mutedForeground,\n  },\n  dayTextDisabled: {\n    color: theme.colors.mutedForeground,\n  },\n  dayTextToday: {\n    fontWeight: theme.typography.weights.semibold,\n  },\n}))\n",
      "type": "registry:ui"
    }
  ]
}
