{
  "name": "overlay",
  "type": "registry:lib",
  "title": "Overlay",
  "description": "Dismiss layer and scrim/backdrop primitive for overlays.",
  "files": [
    {
      "path": "lib/overlay/dismiss-layer-state.ts",
      "content": "export type PointerEvents = \"auto\" | \"none\" | \"box-none\" | \"box-only\"\n\nexport type ResolveDismissLayerStateOptions = {\n  dismissable?: boolean\n  onDismiss?: (() => void) | undefined\n  scrim?: boolean\n  scrimPointerEvents?: PointerEvents\n}\n\nexport type DismissLayerState = {\n  isDismissable: boolean\n  shouldCapture: boolean\n  backdropPointerEvents: PointerEvents\n}\n\nexport function resolveDismissLayerState({\n  dismissable,\n  onDismiss,\n  scrim,\n  scrimPointerEvents,\n}: ResolveDismissLayerStateOptions): DismissLayerState {\n  const isDismissable = dismissable ?? Boolean(onDismiss)\n  const shouldCapture = Boolean(scrim) || isDismissable\n  const backdropPointerEvents =\n    scrimPointerEvents ?? (shouldCapture ? \"auto\" : \"none\")\n\n  return {\n    isDismissable,\n    shouldCapture,\n    backdropPointerEvents,\n  }\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/overlay/index.tsx",
      "content": "import * as React from \"react\"\nimport {\n  Platform,\n  Pressable,\n  type PressableProps,\n  type StyleProp,\n  StyleSheet,\n  View,\n  type ViewProps,\n  type ViewStyle,\n} from \"react-native\"\n\nimport { resolveDismissLayerState } from \"./dismiss-layer-state.js\"\n\nexport type OverlayBackdropProps = Omit<PressableProps, \"style\"> & {\n  style?: StyleProp<ViewStyle>\n  visible?: boolean\n}\n\nexport type DismissLayerProps = ViewProps & {\n  children?: React.ReactNode\n  onDismiss?: () => void\n  dismissable?: boolean\n  scrim?: boolean\n  scrimStyle?: StyleProp<ViewStyle>\n  scrimProps?: Omit<OverlayBackdropProps, \"onPress\" | \"style\" | \"visible\">\n}\n\nexport type OverlayProps = DismissLayerProps\n\ntype OverlayBackdropRef = React.ComponentRef<typeof Pressable>\n\nconst styles = StyleSheet.create({\n  container: {\n    ...StyleSheet.absoluteFillObject,\n  },\n  backdrop: {\n    ...StyleSheet.absoluteFillObject,\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n  },\n  backdropHidden: {\n    backgroundColor: \"transparent\",\n  },\n})\n\n/**\n * A full-screen backdrop component that can optionally be visible (scrim).\n */\nexport const OverlayBackdrop = React.forwardRef<\n  OverlayBackdropRef,\n  OverlayBackdropProps\n>(\n  (\n    {\n      visible = true,\n      style,\n      accessible = false,\n      accessibilityElementsHidden,\n      importantForAccessibility,\n      ...props\n    },\n    ref,\n  ) => {\n    const elementsHidden = accessibilityElementsHidden ?? !accessible\n    const importance =\n      importantForAccessibility ?? (accessible ? undefined : \"no\")\n\n    return (\n      <Pressable\n        ref={ref}\n        accessible={accessible}\n        accessibilityElementsHidden={elementsHidden}\n        importantForAccessibility={importance}\n        style={[styles.backdrop, !visible && styles.backdropHidden, style]}\n        {...props}\n      />\n    )\n  },\n)\n\nOverlayBackdrop.displayName = \"OverlayBackdrop\"\n\n/**\n * A layer that facilitates dismissing content when users interact outside of it\n * or perform a system \"back\" action.\n * \n * **Behaviors:**\n * - **Web:** Adds a global listener for the `Escape` key to trigger `onDismiss`.\n * - **Android:** Adds a `BackHandler` listener to trigger `onDismiss` when the \n *   hardware back button is pressed.\n * - **Click-outside:** Triggers `onDismiss` when the backdrop/scrim is pressed.\n */\nexport const DismissLayer = React.forwardRef<View, DismissLayerProps>(\n  (\n    {\n      children,\n      onDismiss,\n      dismissable,\n      scrim = false,\n      scrimStyle,\n      scrimProps,\n      style,\n      pointerEvents,\n      ...props\n    },\n    ref,\n  ) => {\n    const { pointerEvents: scrimPointerEvents, ...scrimRest } = scrimProps ?? {}\n    const { isDismissable, backdropPointerEvents } = resolveDismissLayerState({\n      dismissable,\n      onDismiss,\n      scrim,\n      scrimPointerEvents,\n    })\n\n    const handlePress = React.useCallback(() => {\n      if (!isDismissable) {\n        return\n      }\n\n      onDismiss?.()\n    }, [isDismissable, onDismiss])\n\n    React.useEffect(() => {\n      // Web: Escape key\n      if (Platform.OS === \"web\") {\n        if (!isDismissable) return\n        if (typeof document === \"undefined\") return\n\n        const handleKeyDown = (event: KeyboardEvent) => {\n          if (event.defaultPrevented) return\n          if (event.key !== \"Escape\" && event.key !== \"Esc\") return\n\n          onDismiss?.()\n        }\n\n        document.addEventListener(\"keydown\", handleKeyDown)\n        return () => document.removeEventListener(\"keydown\", handleKeyDown)\n      }\n\n      // Native: Back button (Android)\n      if (Platform.OS === \"android\") {\n        if (!isDismissable) return\n\n        const { BackHandler } = require(\"react-native\")\n\n        const handleBackPress = () => {\n          onDismiss?.()\n          return true // Prevent default behavior (exit app)\n        }\n\n        const subscription = BackHandler.addEventListener(\n          \"hardwareBackPress\",\n          handleBackPress,\n        )\n        return () => subscription.remove()\n      }\n    }, [isDismissable, onDismiss])\n\n    return (\n      <View\n        ref={ref}\n        pointerEvents={pointerEvents ?? \"box-none\"}\n        style={[styles.container, style]}\n        {...props}\n      >\n        <OverlayBackdrop\n          visible={scrim}\n          onPress={isDismissable ? handlePress : undefined}\n          pointerEvents={backdropPointerEvents}\n          style={scrimStyle}\n          {...scrimRest}\n        />\n        {children}\n      </View>\n    )\n  },\n)\n\nDismissLayer.displayName = \"DismissLayer\"\n\n/**\n * A high-level Overlay component that combines a `DismissLayer` with a visible scrim by default.\n */\nexport const Overlay = React.forwardRef<View, OverlayProps>(\n  ({ scrim = true, ...props }, ref) => {\n    return <DismissLayer ref={ref} scrim={scrim} {...props} />\n  },\n)\n\nOverlay.displayName = \"Overlay\"\n",
      "type": "registry:lib"
    }
  ]
}
