{
  "name": "date-picker",
  "type": "registry:ui",
  "title": "Date Picker",
  "description": "Input-style trigger with a calendar popover for selecting dates.",
  "registryDependencies": [
    "calendar",
    "popover"
  ],
  "files": [
    {
      "path": "components/ui/date-picker.tsx",
      "content": "import * as React from \"react\"\nimport {\n  Platform,\n  Pressable,\n  type PressableProps,\n  Text,\n  type TextProps,\n  type View,\n} from \"react-native\"\nimport { StyleSheet } from \"react-native-unistyles\"\nimport { Calendar, type CalendarProps } from \"./calendar.js\"\nimport {\n  Popover,\n  PopoverContent,\n  type PopoverContentProps,\n  PopoverTrigger,\n} from \"./popover.js\"\n\ntype DatePickerContextValue = {\n  value?: Date\n  onValueChange: (date?: Date) => void\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  month: Date\n  onMonthChange: (month: Date) => void\n  locale?: string | string[]\n  weekStartsOn: 0 | 1 | 2 | 3 | 4 | 5 | 6\n  showOutsideDays: boolean\n  disabled?: boolean\n  minDate?: Date\n  maxDate?: Date\n  disabledDates?: (date: Date) => boolean\n  formatDate: (date: Date) => string\n}\n\nconst DatePickerContext = React.createContext<DatePickerContextValue | undefined>(\n  undefined,\n)\n\nfunction useDatePicker() {\n  const context = React.useContext(DatePickerContext)\n  if (!context) {\n    throw new Error(\"DatePicker components must be used within DatePicker\")\n  }\n  return context\n}\n\nfunction startOfMonth(date: Date) {\n  const next = new Date(date)\n  next.setHours(0, 0, 0, 0)\n  next.setDate(1)\n  return next\n}\n\nfunction isSameMonth(left: Date, right: Date) {\n  return (\n    left.getFullYear() === right.getFullYear() &&\n    left.getMonth() === right.getMonth()\n  )\n}\n\nexport type DatePickerProps = {\n  children: React.ReactNode\n  value?: Date\n  defaultValue?: Date\n  onValueChange?: (date?: Date) => void\n  open?: boolean\n  defaultOpen?: boolean\n  onOpenChange?: (open: boolean) => void\n  month?: Date\n  defaultMonth?: Date\n  onMonthChange?: (month: Date) => void\n  locale?: string | string[]\n  weekStartsOn?: 0 | 1 | 2 | 3 | 4 | 5 | 6\n  showOutsideDays?: boolean\n  disabled?: boolean\n  minDate?: Date\n  maxDate?: Date\n  disabledDates?: (date: Date) => boolean\n  format?: (date: Date) => string\n  modal?: boolean\n}\n\nexport function DatePicker({\n  children,\n  value: valueProp,\n  defaultValue,\n  onValueChange,\n  open: openProp,\n  defaultOpen = false,\n  onOpenChange,\n  month: monthProp,\n  defaultMonth,\n  onMonthChange,\n  locale,\n  weekStartsOn = 0,\n  showOutsideDays = true,\n  disabled,\n  minDate,\n  maxDate,\n  disabledDates,\n  format,\n  modal = false,\n}: DatePickerProps) {\n  const [uncontrolledValue, setUncontrolledValue] = React.useState<\n    Date | undefined\n  >(valueProp ?? defaultValue)\n  const isValueControlled = valueProp !== undefined\n  const currentValue = isValueControlled ? valueProp : uncontrolledValue\n\n  const [open, setOpen] = React.useState(defaultOpen)\n  const isOpenControlled = openProp !== undefined\n  const currentOpen = isOpenControlled ? openProp : open\n\n  const initialMonth = React.useMemo(() => {\n    const base = monthProp ?? defaultMonth ?? currentValue ?? new Date()\n    return startOfMonth(base)\n  }, [currentValue, defaultMonth, monthProp])\n\n  const [uncontrolledMonth, setUncontrolledMonth] =\n    React.useState<Date>(initialMonth)\n  const isMonthControlled = monthProp !== undefined\n  const currentMonth = startOfMonth(isMonthControlled ? monthProp : uncontrolledMonth)\n\n  const handleValueChange = React.useCallback(\n    (nextDate?: Date) => {\n      if (!isValueControlled) {\n        setUncontrolledValue(nextDate)\n      }\n      onValueChange?.(nextDate)\n    },\n    [isValueControlled, onValueChange],\n  )\n\n  const handleOpenChange = React.useCallback(\n    (nextOpen: boolean) => {\n      if (!isOpenControlled) {\n        setOpen(nextOpen)\n      }\n      onOpenChange?.(nextOpen)\n    },\n    [isOpenControlled, onOpenChange],\n  )\n\n  const handleMonthChange = React.useCallback(\n    (nextMonth: Date) => {\n      const normalized = startOfMonth(nextMonth)\n      if (!isMonthControlled) {\n        setUncontrolledMonth(normalized)\n      }\n      onMonthChange?.(normalized)\n    },\n    [isMonthControlled, onMonthChange],\n  )\n\n  React.useEffect(() => {\n    if (!isMonthControlled && currentValue) {\n      if (!isSameMonth(currentValue, currentMonth)) {\n        handleMonthChange(currentValue)\n      }\n    }\n  }, [currentMonth, currentValue, handleMonthChange, isMonthControlled])\n\n  React.useEffect(() => {\n    if (disabled && currentOpen) {\n      handleOpenChange(false)\n    }\n  }, [currentOpen, disabled, handleOpenChange])\n\n  const formatDate = React.useCallback(\n    (date: Date) => {\n      if (format) return format(date)\n      const formatter = new Intl.DateTimeFormat(locale, {\n        year: \"numeric\",\n        month: \"short\",\n        day: \"numeric\",\n      })\n      return formatter.format(date)\n    },\n    [format, locale],\n  )\n\n  return (\n    <DatePickerContext.Provider\n      value={{\n        value: currentValue,\n        onValueChange: handleValueChange,\n        open: !!currentOpen,\n        onOpenChange: handleOpenChange,\n        month: currentMonth,\n        onMonthChange: handleMonthChange,\n        locale,\n        weekStartsOn,\n        showOutsideDays,\n        disabled,\n        minDate,\n        maxDate,\n        disabledDates,\n        formatDate,\n      }}\n    >\n      <Popover open={currentOpen} onOpenChange={handleOpenChange} modal={modal}>\n        {children}\n      </Popover>\n    </DatePickerContext.Provider>\n  )\n}\n\nexport type DatePickerTriggerProps = PressableProps & {\n  asChild?: boolean\n  onKeyDown?: (event: unknown) => void\n}\n\nexport const DatePickerTrigger = React.forwardRef<\n  React.ComponentRef<typeof Pressable>,\n  DatePickerTriggerProps\n>(\n  (\n    {\n      children,\n      asChild,\n      onPress,\n      onFocus,\n      onBlur,\n      onKeyDown,\n      disabled,\n      style,\n      ...props\n    },\n    ref,\n  ) => {\n    const { open, onOpenChange, disabled: pickerDisabled } = useDatePicker()\n    const isDisabled = !!(disabled || pickerDisabled)\n    const variantStyles = styles.useVariants({\n      open,\n      disabled: isDisabled,\n    })\n\n    const handleKeyDown = React.useCallback(\n      // biome-ignore lint/suspicious/noExplicitAny: Web-only keyboard event type\n      (event: any) => {\n        if (Platform.OS !== \"web\" || isDisabled) return\n        if (event.key === \" \" || event.key === \"Enter\" || event.key === \"ArrowDown\") {\n          event.preventDefault()\n          onOpenChange(true)\n        }\n        onKeyDown?.(event)\n      },\n      [isDisabled, onKeyDown, onOpenChange],\n    )\n\n    const handleFocus = React.useCallback(\n      (event: unknown) => {\n        // @ts-expect-error - React Native event type\n        onFocus?.(event)\n      },\n      [onFocus],\n    )\n\n    const handleBlur = React.useCallback(\n      (event: unknown) => {\n        // @ts-expect-error - React Native event type\n        onBlur?.(event)\n      },\n      [onBlur],\n    )\n\n    if (asChild && React.isValidElement(children)) {\n      const child = children as React.ReactElement<{\n        onFocus?: (event: unknown) => void\n        onBlur?: (event: unknown) => void\n        onKeyDown?: (event: unknown) => void\n      }>\n      const childOnFocus = child.props.onFocus\n      const childOnBlur = child.props.onBlur\n      const childOnKeyDown = child.props.onKeyDown\n      return (\n        <PopoverTrigger\n          ref={ref}\n          asChild\n          disabled={isDisabled}\n          onPress={onPress}\n          {...props}\n        >\n          {React.cloneElement(\n            child as React.ReactElement<Record<string, unknown>>,\n            {\n              onFocus: composeEventHandlers(childOnFocus, handleFocus),\n              onBlur: composeEventHandlers(childOnBlur, handleBlur),\n              onKeyDown:\n                Platform.OS === \"web\"\n                  ? composeEventHandlers(childOnKeyDown, handleKeyDown)\n                  : childOnKeyDown,\n              role: Platform.OS === \"web\" ? \"button\" : undefined,\n              \"aria-expanded\": Platform.OS === \"web\" ? open : undefined,\n              \"aria-haspopup\": Platform.OS === \"web\" ? \"dialog\" : undefined,\n              accessibilityRole: \"button\",\n              accessibilityState: {\n                expanded: open,\n                disabled: isDisabled,\n              },\n              disabled: isDisabled,\n            },\n          )}\n        </PopoverTrigger>\n      )\n    }\n\n    return (\n      <PopoverTrigger ref={ref} asChild disabled={isDisabled} onPress={onPress} {...props}>\n        <Pressable\n          role={Platform.OS === \"web\" ? \"button\" : undefined}\n          aria-expanded={Platform.OS === \"web\" ? open : undefined}\n          aria-haspopup={Platform.OS === \"web\" ? \"dialog\" : undefined}\n          accessibilityRole=\"button\"\n          accessibilityState={{\n            expanded: open,\n            disabled: isDisabled,\n          }}\n          disabled={isDisabled}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          // @ts-expect-error - onKeyDown is web-only\n          onKeyDown={Platform.OS === \"web\" ? handleKeyDown : undefined}\n          style={({ pressed }) =>\n            [\n              styles.trigger,\n              variantStyles,\n              pressed && !isDisabled && styles.triggerPressed,\n              typeof style === \"function\" ? style({ pressed }) : style,\n              // biome-ignore lint/suspicious/noExplicitAny: Complex style array with variants requires type assertion\n            ] as any\n          }\n        >\n          {children ?? <DatePickerValue />}\n        </Pressable>\n      </PopoverTrigger>\n    )\n  },\n)\n\nDatePickerTrigger.displayName = \"DatePickerTrigger\"\n\nexport type DatePickerValueProps = TextProps & {\n  placeholder?: string\n  format?: (date: Date) => string\n}\n\nexport const DatePickerValue = React.forwardRef<Text, DatePickerValueProps>(\n  ({ placeholder = \"Pick a date\", format, style, children, ...props }, ref) => {\n    const { value, formatDate, disabled } = useDatePicker()\n    const hasCustomChildren = children !== undefined && children !== null\n    const formatted = value ? (format ?? formatDate)(value) : undefined\n    const displayValue = hasCustomChildren ? children : formatted\n    const isPlaceholder = displayValue === undefined || displayValue === null\n\n    return (\n      <Text\n        ref={ref}\n        style={[\n          styles.value,\n          isPlaceholder && styles.valuePlaceholder,\n          disabled && styles.valueDisabled,\n          style,\n        ]}\n        {...props}\n      >\n        {isPlaceholder ? placeholder : displayValue}\n      </Text>\n    )\n  },\n)\n\nDatePickerValue.displayName = \"DatePickerValue\"\n\nexport type DatePickerContentProps = PopoverContentProps\n\nexport const DatePickerContent = React.forwardRef<View, DatePickerContentProps>(\n  ({ align = \"start\", style, ...props }, ref) => {\n    return (\n      <PopoverContent\n        ref={ref}\n        align={align}\n        style={[styles.content, style]}\n        {...props}\n      />\n    )\n  },\n)\n\nDatePickerContent.displayName = \"DatePickerContent\"\n\nexport type DatePickerCalendarProps = Omit<\n  CalendarProps,\n  | \"value\"\n  | \"defaultValue\"\n  | \"onValueChange\"\n  | \"month\"\n  | \"defaultMonth\"\n  | \"onMonthChange\"\n  | \"locale\"\n  | \"weekStartsOn\"\n  | \"showOutsideDays\"\n  | \"disabled\"\n  | \"minDate\"\n  | \"maxDate\"\n  | \"disabledDates\"\n> & {\n  closeOnSelect?: boolean\n}\n\nexport const DatePickerCalendar = React.forwardRef<View, DatePickerCalendarProps>(\n  ({ closeOnSelect = true, style, ...props }, ref) => {\n    const {\n      value,\n      onValueChange,\n      onOpenChange,\n      month,\n      onMonthChange,\n      locale,\n      weekStartsOn,\n      showOutsideDays,\n      disabled,\n      minDate,\n      maxDate,\n      disabledDates,\n    } = useDatePicker()\n\n    const handleValueChange = React.useCallback(\n      (nextDate?: Date) => {\n        onValueChange(nextDate)\n        if (closeOnSelect) {\n          onOpenChange(false)\n        }\n      },\n      [closeOnSelect, onOpenChange, onValueChange],\n    )\n\n    return (\n      <Calendar\n        ref={ref}\n        value={value}\n        onValueChange={handleValueChange}\n        month={month}\n        onMonthChange={onMonthChange}\n        locale={locale}\n        weekStartsOn={weekStartsOn}\n        showOutsideDays={showOutsideDays}\n        disabled={disabled}\n        minDate={minDate}\n        maxDate={maxDate}\n        disabledDates={disabledDates}\n        role={Platform.OS === \"web\" ? \"grid\" : undefined}\n        style={[styles.calendar, style]}\n        {...props}\n      />\n    )\n  },\n)\n\nDatePickerCalendar.displayName = \"DatePickerCalendar\"\n\nfunction composeEventHandlers<E>(\n  originalEventHandler?: (event: E) => void,\n  ourEventHandler?: (event: E) => void,\n  { checkForDefaultPrevented = true } = {},\n) {\n  return function handleEvent(event: E) {\n    originalEventHandler?.(event)\n\n    if (\n      checkForDefaultPrevented === false ||\n      !(event as unknown as { defaultPrevented: boolean })?.defaultPrevented\n    ) {\n      return ourEventHandler?.(event)\n    }\n  }\n}\n\nconst styles = StyleSheet.create((theme) => ({\n  trigger: {\n    minHeight: theme.spacing[10],\n    borderRadius: theme.radius.md,\n    borderWidth: 1,\n    borderColor: theme.colors.input,\n    backgroundColor: theme.colors.background,\n    paddingHorizontal: theme.spacing[3],\n    justifyContent: \"center\",\n    variants: {\n      open: {\n        true: {\n          borderColor: theme.colors.ring,\n          shadowColor: theme.colors.ring,\n          shadowOpacity: 0.35,\n          shadowRadius: 4,\n          shadowOffset: { width: 0, height: 0 },\n        },\n      },\n      disabled: {\n        true: {\n          opacity: 0.5,\n        },\n      },\n    },\n  },\n  triggerPressed: {\n    backgroundColor: theme.colors.muted,\n  },\n  value: {\n    fontSize: theme.typography.sizes.sm,\n    lineHeight: theme.typography.lineHeights.sm,\n    color: theme.colors.foreground,\n  },\n  valuePlaceholder: {\n    color: theme.colors.mutedForeground,\n  },\n  valueDisabled: {\n    color: theme.colors.mutedForeground,\n  },\n  content: {\n    padding: 0,\n    borderWidth: 0,\n    backgroundColor: \"transparent\",\n  },\n  calendar: {\n    borderWidth: 0,\n  },\n}))\n",
      "type": "registry:ui"
    }
  ]
}
