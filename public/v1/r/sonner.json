{
  "name": "sonner",
  "type": "registry:ui",
  "title": "Sonner",
  "description": "An opinionated toast component for React Native.",
  "dependencies": [
    "lucide-react-native",
    "react-native-unistyles"
  ],
  "registryDependencies": [
    "tokens",
    "portal"
  ],
  "files": [
    {
      "path": "components/ui/sonner.tsx",
      "content": "// @ts-expect-error - lucide-react-native is a peer dependency\nimport { AlertCircle, AlertTriangle, Check, Info } from \"lucide-react-native\"\nimport * as React from \"react\"\nimport { Animated, Platform, Pressable, Text, View } from \"react-native\"\nimport { StyleSheet, useUnistyles } from \"react-native-unistyles\"\nimport { Portal } from \"../primitives/portal/index.js\"\n\nconst TOAST_LIMIT = 3\nconst _TOAST_REMOVE_DELAY = 1000000\nconst GAP = 14\nconst _SWIPE_THRESHOLD = 50\n\ntype ToastType =\n  | \"normal\"\n  | \"action\"\n  | \"success\"\n  | \"info\"\n  | \"warning\"\n  | \"error\"\n  | \"loading\"\n\nexport type ToastProps = {\n  id: string\n  title?: string\n  description?: string\n  type?: ToastType\n  action?: {\n    label: string\n    onClick: () => void\n  }\n  cancel?: {\n    label: string\n    onClick: () => void\n  }\n  onDismiss?: () => void\n  onAutoClose?: () => void\n  duration?: number\n  important?: boolean\n  closeButton?: boolean\n  dismissible?: boolean\n}\n\ntype ToastState = ToastProps & {\n  open: boolean\n}\n\n// ----------------------------------------------------------------------------\n// State\n// ----------------------------------------------------------------------------\n\nlet count = 0\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType =\n  | { type: \"ADD_TOAST\"; toast: ToastProps }\n  | { type: \"UPDATE_TOAST\"; toast: Partial<ToastProps> }\n  | { type: \"DISMISS_TOAST\"; toastId?: string }\n  | { type: \"REMOVE_TOAST\"; toastId?: string }\n\ninterface State {\n  toasts: ToastState[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) return\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({ type: \"REMOVE_TOAST\", toastId: toastId })\n  }, 1000) // Short delay to allow animation to finish\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: ActionType): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [{ ...action.toast, open: true }, ...state.toasts].slice(\n          0,\n          TOAST_LIMIT + 1,\n        ),\n      }\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t,\n        ),\n      }\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n      if (toastId) addToRemoveQueue(toastId)\n      else\n        state.toasts.forEach((t) => {\n          addToRemoveQueue(t.id)\n        })\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined ? { ...t, open: false } : t,\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) return { ...state, toasts: [] }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: ActionType) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\nfunction toast(\n  message: string | Omit<ToastProps, \"id\">,\n  data?: Omit<ToastProps, \"id\" | \"title\">,\n) {\n  const id = genId()\n  const props: Omit<ToastProps, \"id\"> =\n    typeof message === \"string\" ? { title: message, ...data } : message\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: { ...props, id },\n  })\n\n  return id\n}\n\ntoast.message = (message: string, data?: Omit<ToastProps, \"id\" | \"title\">) =>\n  toast(message, { ...data, type: \"normal\" })\ntoast.error = (message: string, data?: Omit<ToastProps, \"id\" | \"title\">) =>\n  toast(message, { ...data, type: \"error\" })\ntoast.success = (message: string, data?: Omit<ToastProps, \"id\" | \"title\">) =>\n  toast(message, { ...data, type: \"success\" })\ntoast.info = (message: string, data?: Omit<ToastProps, \"id\" | \"title\">) =>\n  toast(message, { ...data, type: \"info\" })\ntoast.warning = (message: string, data?: Omit<ToastProps, \"id\" | \"title\">) =>\n  toast(message, { ...data, type: \"warning\" })\n// biome-ignore lint/suspicious/noExplicitAny: Not implemented yet\ntoast.custom = (_jsx: any) => {\n  /* Not implemented yet for custom JSX */\n}\ntoast.dismiss = (toastId?: string) =>\n  dispatch({ type: \"DISMISS_TOAST\", toastId })\n\nfunction useSonner() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) listeners.splice(index, 1)\n    }\n  }, [])\n\n  return state\n}\n\nconst ToastIcon = ({ type }: { type?: ToastType }) => {\n  const { theme } = useUnistyles()\n  switch (type) {\n    case \"success\":\n      return <Check size={18} color={theme.colors.primary} />\n    case \"error\":\n      return <AlertCircle size={18} color={theme.colors.destructive} />\n    case \"info\":\n      return <Info size={18} color={theme.colors.primary} />\n    case \"warning\":\n      return <AlertTriangle size={18} color={theme.colors.destructive} />\n    case \"loading\":\n      return <Text>...</Text>\n    default:\n      return null\n  }\n}\n\nconst styles = StyleSheet.create((theme) => ({\n  viewport: {\n    position: \"absolute\",\n    bottom: 0,\n    left: 0,\n    right: 0,\n    padding: 20,\n    zIndex: 9999,\n    alignItems: \"center\",\n    pointerEvents: \"box-none\",\n    paddingBottom: Platform.OS === \"ios\" ? 44 : 20,\n  },\n  toast: {\n    position: \"absolute\",\n    bottom: 0,\n    width: \"100%\",\n    maxWidth: 400,\n    backgroundColor: theme.colors.background,\n    borderRadius: theme.radius.lg,\n    borderWidth: 1,\n    borderColor: theme.colors.border,\n    padding: 16,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 12,\n    shadowColor: theme.colors.foreground,\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.1,\n    shadowRadius: 8,\n    elevation: 4,\n  },\n  content: {\n    flex: 1,\n    gap: 4,\n  },\n  title: {\n    fontSize: theme.typography.sizes.sm,\n    fontWeight: theme.typography.weights.semibold,\n    color: theme.colors.foreground,\n  },\n  description: {\n    fontSize: theme.typography.sizes.xs,\n    color: theme.colors.mutedForeground,\n  },\n  actionButton: {\n    backgroundColor: theme.colors.primary,\n    paddingHorizontal: 12,\n    paddingVertical: 6,\n    borderRadius: theme.radius.md,\n  },\n  actionText: {\n    fontSize: theme.typography.sizes.xs,\n    fontWeight: theme.typography.weights.medium,\n    color: theme.colors.background,\n  },\n  cancelButton: {\n    paddingHorizontal: 12,\n    paddingVertical: 6,\n    borderRadius: theme.radius.md,\n    borderWidth: 1,\n    borderColor: theme.colors.border,\n  },\n  cancelText: {\n    fontSize: theme.typography.sizes.xs,\n    color: theme.colors.foreground,\n  },\n}))\n\nconst ToastCard = ({\n  item,\n  index,\n  onDismiss,\n}: {\n  item: ToastState\n  index: number\n  isFront: boolean\n  onDismiss: (id: string) => void\n  count: number\n}) => {\n  const fadeAnim = React.useRef(new Animated.Value(0)).current // Opacity\n  const translateY = React.useRef(new Animated.Value(20)).current // Initial slide up\n  const scale = React.useRef(new Animated.Value(1)).current\n\n  const isVisible = index < TOAST_LIMIT && item.open\n\n  React.useEffect(() => {\n    if (item.open) {\n      Animated.parallel([\n        Animated.timing(fadeAnim, {\n          toValue: 1,\n          duration: 200,\n          useNativeDriver: true,\n        }),\n        Animated.spring(translateY, {\n          toValue: index * -GAP,\n          useNativeDriver: true,\n        }),\n        Animated.spring(scale, {\n          toValue: 1 - index * 0.05,\n          useNativeDriver: true,\n        }),\n      ]).start()\n    } else {\n      Animated.timing(fadeAnim, {\n        toValue: 0,\n        duration: 150,\n        useNativeDriver: true,\n      }).start()\n    }\n  }, [index, item.open, fadeAnim, translateY, scale])\n\n  // Handle auto-close\n  React.useEffect(() => {\n    if (item.open && item.duration !== Number.POSITIVE_INFINITY) {\n      const duration = item.duration ?? 4000\n      const timer = setTimeout(() => {\n        item.onAutoClose?.()\n        onDismiss(item.id)\n      }, duration)\n      return () => clearTimeout(timer)\n    }\n  }, [item.id, item.open, item.duration, onDismiss, item.onAutoClose])\n\n  // Handle onDismiss callback when toast closes\n  const prevOpen = React.useRef(item.open)\n  React.useEffect(() => {\n    if (prevOpen.current && !item.open) {\n      item.onDismiss?.()\n    }\n    prevOpen.current = item.open\n  }, [item.open, item.onDismiss])\n\n  if (!isVisible) return null\n\n  return (\n    <Animated.View\n      style={[\n        styles.toast,\n        {\n          opacity: fadeAnim,\n          transform: [{ translateY }, { scale }],\n          zIndex: TOAST_LIMIT - index,\n        },\n      ]}\n    >\n      <ToastIcon type={item.type} />\n      <View style={styles.content}>\n        {item.title && <Text style={styles.title}>{item.title}</Text>}\n        {item.description && (\n          <Text style={styles.description}>{item.description}</Text>\n        )}\n      </View>\n      {item.action && (\n        <Pressable onPress={item.action.onClick} style={styles.actionButton}>\n          <Text style={styles.actionText}>{item.action.label}</Text>\n        </Pressable>\n      )}\n      {item.cancel && (\n        <Pressable onPress={item.cancel.onClick} style={styles.cancelButton}>\n          <Text style={styles.cancelText}>{item.cancel.label}</Text>\n        </Pressable>\n      )}\n    </Animated.View>\n  )\n}\n\nexport function Toaster() {\n  const { toasts } = useSonner()\n\n  const handleDismiss = React.useCallback((id: string) => {\n    dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n  }, [])\n\n  return (\n    <Portal>\n      <View style={styles.viewport} pointerEvents=\"box-none\">\n        {toasts.map((toast, index) => (\n          <ToastCard\n            key={toast.id}\n            item={toast}\n            index={index}\n            isFront={index === 0}\n            count={toasts.length}\n            onDismiss={handleDismiss}\n          />\n        ))}\n      </View>\n    </Portal>\n  )\n}\n\nexport { toast }\n",
      "type": "registry:ui"
    }
  ]
}
