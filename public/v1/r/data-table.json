{
  "name": "data-table",
  "type": "registry:ui",
  "title": "Data Table",
  "description": "Tabular data display with sorting and basic row interactions.",
  "registryDependencies": [
    "tokens"
  ],
  "files": [
    {
      "path": "components/ui/data-table.tsx",
      "content": "import * as React from \"react\"\nimport {\n  Platform,\n  Pressable,\n  Text,\n  type StyleProp,\n  type DimensionValue,\n  View,\n  type ViewProps,\n  type ViewStyle,\n  type TextStyle,\n} from \"react-native\"\nimport { StyleSheet } from \"react-native-unistyles\"\n\nexport type DataTableSort = {\n  id: string\n  desc?: boolean\n}\n\nexport type DataTableColumn<T> = {\n  id: string\n  header?: React.ReactNode | ((column: DataTableColumn<T>) => React.ReactNode)\n  accessor?: keyof T | ((row: T) => unknown)\n  cell?: (row: T, rowIndex: number) => React.ReactNode\n  sortable?: boolean\n  sortAccessor?: (row: T) => unknown\n  sortComparer?: (left: T, right: T) => number\n  align?: \"left\" | \"center\" | \"right\"\n  width?: DimensionValue\n}\n\nexport type DataTableProps<T> = ViewProps & {\n  data: T[]\n  columns: DataTableColumn<T>[]\n  getRowId?: (row: T) => string\n  onRowPress?: (row: T, index: number) => void\n  emptyMessage?: string\n  loading?: boolean\n  renderEmpty?: React.ReactNode\n  renderLoading?: React.ReactNode\n  sort?: DataTableSort\n  defaultSort?: DataTableSort\n  onSortChange?: (sort?: DataTableSort) => void\n  rowStyle?: StyleProp<ViewStyle>\n  headerCellStyle?: StyleProp<ViewStyle>\n  cellStyle?: StyleProp<ViewStyle>\n  textStyle?: StyleProp<TextStyle>\n}\n\ntype DataTableComponent = (<T>(\n  props: DataTableProps<T> & React.RefAttributes<View>,\n) => React.ReactElement | null) & {\n  displayName?: string\n}\n\nfunction getSortValue<T>(column: DataTableColumn<T>, row: T) {\n  if (column.sortAccessor) return column.sortAccessor(row)\n  if (typeof column.accessor === \"function\") return column.accessor(row)\n  if (typeof column.accessor === \"string\") {\n    const record = row as Record<string, unknown>\n    return record[column.accessor]\n  }\n  return undefined\n}\n\nfunction normalizeSortValue(value: unknown) {\n  if (value === null || value === undefined) return null\n  if (value instanceof Date) return value.getTime()\n  if (typeof value === \"boolean\") return value ? 1 : 0\n  if (typeof value === \"number\") return value\n  if (typeof value === \"string\") return value.toLowerCase()\n  return String(value).toLowerCase()\n}\n\nfunction resolveCellValue<T>(\n  column: DataTableColumn<T>,\n  row: T,\n  rowIndex: number,\n) {\n  if (column.cell) return column.cell(row, rowIndex)\n  if (typeof column.accessor === \"function\") {\n    return coerceCellValue(column.accessor(row))\n  }\n  if (typeof column.accessor === \"string\") {\n    const record = row as Record<string, unknown>\n    return coerceCellValue(record[column.accessor])\n  }\n  return null\n}\n\nfunction coerceCellValue(value: unknown): React.ReactNode {\n  if (value === null || value === undefined) return null\n  if (React.isValidElement(value)) return value\n  if (typeof value === \"string\" || typeof value === \"number\") return value\n  if (typeof value === \"boolean\") return value ? \"true\" : \"false\"\n  if (value instanceof Date) return value.toLocaleDateString()\n  return String(value)\n}\n\n/**\n * DataTable component for rendering tabular data with optional sorting.\n *\n * **Web-first notes:**\n * - Header cells expose basic keyboard sorting (Enter/Space).\n * - ARIA roles are applied to reflect table structure on web.\n *\n * **Native limitations:**\n * - Rendered using View/Text instead of semantic table elements.\n * - Large datasets should use FlatList or virtualization.\n */\nexport const DataTable = React.forwardRef(function DataTable<T>(\n  {\n    data,\n    columns,\n    getRowId,\n    onRowPress,\n    emptyMessage = \"No results.\",\n    loading = false,\n    renderEmpty,\n    renderLoading,\n    sort: sortProp,\n    defaultSort,\n    onSortChange,\n    rowStyle,\n    headerCellStyle,\n    cellStyle,\n    textStyle,\n    style,\n    ...props\n  }: DataTableProps<T>,\n  ref: React.Ref<View>,\n) {\n    const [uncontrolledSort, setUncontrolledSort] =\n      React.useState<DataTableSort | undefined>(defaultSort)\n    const isSortControlled = sortProp !== undefined\n    const currentSort = isSortControlled ? sortProp : uncontrolledSort\n\n    const rowKeyMapRef = React.useRef(new WeakMap<object, string>())\n    const rowKeyCounterRef = React.useRef(0)\n\n    const handleSortChange = React.useCallback(\n      (nextSort?: DataTableSort) => {\n        if (!isSortControlled) {\n          setUncontrolledSort(nextSort)\n        }\n        onSortChange?.(nextSort)\n      },\n      [isSortControlled, onSortChange],\n    )\n\n    const sortedData = React.useMemo(() => {\n      if (!currentSort) return data\n      const column = columns.find((col) => col.id === currentSort.id)\n      if (!column) return data\n      if (!column.sortable) return data\n\n      if (column.sortComparer) {\n        const sorted = data\n          .map((row, index) => ({ row, index }))\n          .sort((left, right) => {\n            const result = column.sortComparer?.(left.row, right.row) ?? 0\n            if (result !== 0) {\n              return currentSort.desc ? -result : result\n            }\n            return left.index - right.index\n          })\n          .map((item) => item.row)\n        return sorted\n      }\n\n      const sorted = data\n        .map((row, index) => ({ row, index }))\n        .sort((left, right) => {\n          const leftValue = normalizeSortValue(getSortValue(column, left.row))\n          const rightValue = normalizeSortValue(getSortValue(column, right.row))\n\n          if (leftValue === null && rightValue === null) {\n            return left.index - right.index\n          }\n          if (leftValue === null) return 1\n          if (rightValue === null) return -1\n\n          if (typeof leftValue === \"number\" && typeof rightValue === \"number\") {\n            const result = leftValue - rightValue\n            return currentSort.desc ? -result : result\n          }\n\n          const result = String(leftValue).localeCompare(String(rightValue))\n          if (result !== 0) {\n            return currentSort.desc ? -result : result\n          }\n          return left.index - right.index\n        })\n        .map((item) => item.row)\n      return sorted\n    }, [columns, currentSort, data])\n\n    const handleHeaderPress = React.useCallback(\n      (column: DataTableColumn<T>) => {\n        if (!column.sortable) return\n        if (!currentSort || currentSort.id !== column.id) {\n          handleSortChange({ id: column.id, desc: false })\n          return\n        }\n        if (currentSort.desc) {\n          handleSortChange(undefined)\n          return\n        }\n        handleSortChange({ id: column.id, desc: true })\n      },\n      [currentSort, handleSortChange],\n    )\n\n    const resolveRowKey = React.useCallback(\n      (row: T) => {\n        if (getRowId) {\n          return getRowId(row)\n        }\n        if (row && typeof row === \"object\") {\n          if (\"id\" in row) {\n            return String((row as { id?: unknown }).id)\n          }\n          if (\"key\" in row) {\n            return String((row as { key?: unknown }).key)\n          }\n          const storedKey = rowKeyMapRef.current.get(row)\n          if (storedKey) return storedKey\n          const nextKey = `row-${rowKeyCounterRef.current++}`\n          rowKeyMapRef.current.set(row, nextKey)\n          return nextKey\n        }\n        return String(row)\n      },\n      [getRowId],\n    )\n\n    const renderHeaderCell = (column: DataTableColumn<T>) => {\n      const headerContent =\n        typeof column.header === \"function\"\n          ? column.header(column)\n          : column.header ?? column.id\n      const isSorted = currentSort?.id === column.id\n      const sortDirection = isSorted\n        ? currentSort?.desc\n          ? \"descending\"\n          : \"ascending\"\n        : \"none\"\n      const columnWidth =\n        column.width !== undefined ? { width: column.width } : styles.cellFlex\n      const alignStyle =\n        column.align === \"center\"\n          ? styles.cellAlignCenter\n          : column.align === \"right\"\n            ? styles.cellAlignRight\n            : undefined\n\n      if (column.sortable) {\n        return (\n          <Pressable\n            key={column.id}\n            role={Platform.OS === \"web\" ? \"columnheader\" : undefined}\n            aria-sort={Platform.OS === \"web\" ? sortDirection : undefined}\n            accessibilityRole=\"button\"\n            accessibilityState={{ selected: isSorted }}\n            onPress={() => handleHeaderPress(column)}\n            // @ts-expect-error - onKeyDown is web-only\n            onKeyDown={\n              Platform.OS === \"web\"\n                ? (event: { key?: string; preventDefault?: () => void }) => {\n                    if (event.key === \"Enter\" || event.key === \" \") {\n                      event.preventDefault?.()\n                      handleHeaderPress(column)\n                    }\n                  }\n                : undefined\n            }\n            style={[styles.cell, styles.headerCell, columnWidth, alignStyle, headerCellStyle]}\n          >\n            {typeof headerContent === \"string\" ||\n            typeof headerContent === \"number\" ? (\n              <Text style={[styles.headerText, textStyle]}>{headerContent}</Text>\n            ) : (\n              headerContent\n            )}\n            {isSorted ? (\n              <Text style={styles.sortIndicator}>\n                {currentSort?.desc ? \"v\" : \"^\"}\n              </Text>\n            ) : null}\n          </Pressable>\n        )\n      }\n\n      return (\n        <View\n          key={column.id}\n          role={Platform.OS === \"web\" ? \"columnheader\" : undefined}\n          style={[styles.cell, styles.headerCell, columnWidth, alignStyle, headerCellStyle]}\n        >\n          {typeof headerContent === \"string\" ||\n          typeof headerContent === \"number\" ? (\n            <Text style={[styles.headerText, textStyle]}>{headerContent}</Text>\n          ) : (\n            headerContent\n          )}\n        </View>\n      )\n    }\n\n    const renderBodyContent = () => {\n      if (loading) {\n        return (\n          <View style={styles.emptyRow}>\n            {renderLoading ?? (\n              <Text style={[styles.emptyText, textStyle]}>Loading...</Text>\n            )}\n          </View>\n        )\n      }\n      if (sortedData.length === 0) {\n        return (\n          <View style={styles.emptyRow}>\n            {renderEmpty ?? (\n              <Text style={[styles.emptyText, textStyle]}>{emptyMessage}</Text>\n            )}\n          </View>\n        )\n      }\n\n      return sortedData.map((row, rowIndex) => {\n        const rowKey = resolveRowKey(row)\n        const handleRowPress = (event: unknown) => {\n          if (onRowPress) {\n            onRowPress(row, rowIndex)\n          }\n          return event\n        }\n\n        const rowContent = columns.map((column) => {\n          const content = resolveCellValue(column, row, rowIndex)\n          const columnWidth =\n            column.width !== undefined ? { width: column.width } : styles.cellFlex\n          const alignStyle =\n            column.align === \"center\"\n              ? styles.cellAlignCenter\n              : column.align === \"right\"\n                ? styles.cellAlignRight\n                : undefined\n\n          return (\n            <View\n              key={`${rowKey}-${column.id}`}\n              role={Platform.OS === \"web\" ? \"cell\" : undefined}\n              style={[styles.cell, columnWidth, alignStyle, cellStyle]}\n            >\n              {typeof content === \"string\" || typeof content === \"number\" ? (\n                <Text style={[styles.cellText, textStyle]}>{content}</Text>\n              ) : (\n                content\n              )}\n            </View>\n          )\n        })\n\n        if (onRowPress) {\n          return (\n            <Pressable\n              key={rowKey}\n              role={Platform.OS === \"web\" ? \"row\" : undefined}\n              accessibilityRole=\"button\"\n              onPress={handleRowPress}\n              style={({ pressed }) =>\n                [\n                  styles.row,\n                  rowStyle,\n                  pressed && styles.rowPressed,\n                  // biome-ignore lint/suspicious/noExplicitAny: Complex style array with variants requires type assertion\n                ] as any\n              }\n            >\n              {rowContent}\n            </Pressable>\n          )\n        }\n\n        return (\n          <View\n            key={rowKey}\n            role={Platform.OS === \"web\" ? \"row\" : undefined}\n            style={[styles.row, rowStyle]}\n          >\n            {rowContent}\n          </View>\n        )\n      })\n    }\n\n    return (\n      <View\n        ref={ref}\n        role={Platform.OS === \"web\" ? \"table\" : undefined}\n        style={[styles.container, style]}\n        {...props}\n      >\n        <View role={Platform.OS === \"web\" ? \"rowgroup\" : undefined} style={styles.header}>\n          <View role={Platform.OS === \"web\" ? \"row\" : undefined} style={styles.row}>\n            {columns.map(renderHeaderCell)}\n          </View>\n        </View>\n        <View role={Platform.OS === \"web\" ? \"rowgroup\" : undefined} style={styles.body}>\n          {renderBodyContent()}\n        </View>\n      </View>\n    )\n  },\n) as DataTableComponent\n\nDataTable.displayName = \"DataTable\"\n\nconst styles = StyleSheet.create((theme) => ({\n  container: {\n    width: \"100%\",\n    borderWidth: 1,\n    borderColor: theme.colors.border,\n    borderRadius: theme.radius.md,\n    backgroundColor: theme.colors.background,\n    overflow: \"hidden\",\n  },\n  header: {\n    backgroundColor: theme.colors.muted,\n  },\n  body: {},\n  row: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderBottomWidth: 1,\n    borderBottomColor: theme.colors.border,\n  },\n  rowPressed: {\n    backgroundColor: theme.colors.muted,\n  },\n  cell: {\n    paddingVertical: theme.spacing[2],\n    paddingHorizontal: theme.spacing[3],\n    justifyContent: \"center\",\n  },\n  headerCell: {\n    minHeight: theme.spacing[10],\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: theme.spacing[1],\n  },\n  headerText: {\n    fontSize: theme.typography.sizes.xs,\n    letterSpacing: 0.5,\n    textTransform: \"uppercase\",\n    color: theme.colors.mutedForeground,\n  },\n  cellText: {\n    fontSize: theme.typography.sizes.sm,\n    color: theme.colors.foreground,\n  },\n  cellFlex: {\n    flex: 1,\n  },\n  cellAlignCenter: {\n    alignItems: \"center\",\n  },\n  cellAlignRight: {\n    alignItems: \"flex-end\",\n  },\n  sortIndicator: {\n    fontSize: theme.typography.sizes.xs,\n    color: theme.colors.mutedForeground,\n  },\n  emptyRow: {\n    paddingVertical: theme.spacing[6],\n    paddingHorizontal: theme.spacing[3],\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  emptyText: {\n    fontSize: theme.typography.sizes.sm,\n    color: theme.colors.mutedForeground,\n  },\n}))\n",
      "type": "registry:ui"
    }
  ]
}
