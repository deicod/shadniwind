{
  "name": "resizable",
  "type": "registry:ui",
  "title": "Resizable",
  "description": "Resizable panel group with draggable handles and web keyboard support.",
  "registryDependencies": [
    "@shadniwind/tokens",
    "@shadniwind/press"
  ],
  "files": [
    {
      "path": "components/ui/resizable.tsx",
      "content": "import * as React from \"react\"\nimport {\n  PanResponder,\n  Platform,\n  type LayoutChangeEvent,\n  View,\n  type ViewProps,\n  type ViewStyle,\n} from \"react-native\"\nimport { StyleSheet } from \"react-native-unistyles\"\n\ntype ResizableDirection = \"horizontal\" | \"vertical\"\n\ntype PanelConstraints = {\n  minSize?: number\n  maxSize?: number\n}\n\ntype ResizableContextValue = {\n  direction: ResizableDirection\n  sizes: number[]\n  panelCount: number\n  containerSize: number\n  setContainerSize: (size: number) => void\n  registerPanel: (index: number, constraints: PanelConstraints) => () => void\n  resizeByDelta: (index: number, deltaPx: number) => void\n  resizeByPercent: (index: number, deltaPercent: number) => void\n}\n\nconst ResizableContext = React.createContext<ResizableContextValue | null>(null)\n\nfunction useResizable() {\n  const context = React.useContext(ResizableContext)\n  if (!context) {\n    throw new Error(\n      \"Resizable components must be used within ResizablePanelGroup\",\n    )\n  }\n  return context\n}\n\nfunction clamp(value: number, min: number, max: number) {\n  return Math.min(Math.max(value, min), max)\n}\n\nfunction normalizeSizes(sizes: number[], count: number) {\n  if (count <= 0) return []\n  const safeSizes = sizes.map((value) => (Number.isFinite(value) ? Math.max(0, value) : 0))\n  const total = safeSizes.reduce((sum, value) => sum + value, 0)\n  if (total <= 0) {\n    return Array.from({ length: count }, () => 100 / count)\n  }\n  return safeSizes.map((value) => (value / total) * 100)\n}\n\nexport type ResizablePanelProps = ViewProps & {\n  defaultSize?: number\n  minSize?: number\n  maxSize?: number\n  collapsible?: boolean\n  collapsedSize?: number\n  _index?: number\n}\n\nexport type ResizableHandleProps = ViewProps & {\n  disabled?: boolean\n  withHandle?: boolean\n  keyboardStep?: number\n  _index?: number\n}\n\nexport type ResizablePanelGroupProps = ViewProps & {\n  direction?: ResizableDirection\n  sizes?: number[]\n  defaultSizes?: number[]\n  onSizesChange?: (sizes: number[]) => void\n}\n\n/**\n * Resizable panel group (web-first).\n *\n * **Limitations:**\n * - Panels use percentage sizing; keep counts modest.\n * - Native support is basic (drag handles); no keyboard resizing.\n */\nexport const ResizablePanelGroup = React.forwardRef<\n  View,\n  ResizablePanelGroupProps\n>(\n  (\n    {\n      direction = \"horizontal\",\n      sizes: sizesProp,\n      defaultSizes,\n      onSizesChange,\n      style,\n      children,\n      onLayout,\n      ...props\n    },\n    ref,\n  ) => {\n    const [containerSize, setContainerSize] = React.useState(0)\n\n    const { enhancedChildren, panelDefaults } = React.useMemo(() => {\n      const isResizablePanelElement = (\n        child: React.ReactNode,\n      ): child is React.ReactElement<ResizablePanelProps> =>\n        React.isValidElement(child) && child.type === ResizablePanel\n      const isResizableHandleElement = (\n        child: React.ReactNode,\n      ): child is React.ReactElement<ResizableHandleProps> =>\n        React.isValidElement(child) && child.type === ResizableHandle\n      let panelIndex = -1\n      const defaults: Array<number | undefined> = []\n      const mapped = React.Children.map(children, (child) => {\n        if (isResizablePanelElement(child)) {\n          panelIndex += 1\n          const defaultSize =\n            typeof child.props.defaultSize === \"number\"\n              ? child.props.defaultSize\n              : undefined\n          defaults.push(defaultSize)\n          return React.cloneElement(child, { _index: panelIndex })\n        }\n        if (isResizableHandleElement(child)) {\n          return React.cloneElement(child, { _index: panelIndex })\n        }\n        return child\n      })\n      return { enhancedChildren: mapped, panelDefaults: defaults }\n    }, [children])\n\n    const panelCount = panelDefaults.length\n    const hasPanelDefaults = panelDefaults.some(\n      (value) => typeof value === \"number\",\n    )\n\n    const initialSizes = React.useMemo(() => {\n      if (panelCount === 0) return []\n      if (defaultSizes && defaultSizes.length === panelCount) {\n        return normalizeSizes(defaultSizes, panelCount)\n      }\n      if (hasPanelDefaults) {\n        const normalizedDefaults = panelDefaults.map((value) =>\n          typeof value === \"number\" ? value : 0,\n        )\n        return normalizeSizes(normalizedDefaults, panelCount)\n      }\n      return normalizeSizes(Array.from({ length: panelCount }, () => 1), panelCount)\n    }, [defaultSizes, hasPanelDefaults, panelCount, panelDefaults])\n\n    const [uncontrolledSizes, setUncontrolledSizes] = React.useState(() => initialSizes)\n\n    const isControlled = sizesProp !== undefined\n    const resolvedSizes = React.useMemo(() => {\n      if (panelCount === 0) return []\n      if (isControlled && sizesProp && sizesProp.length === panelCount) {\n        return normalizeSizes(sizesProp, panelCount)\n      }\n      if (!isControlled && uncontrolledSizes.length === panelCount) {\n        return normalizeSizes(uncontrolledSizes, panelCount)\n      }\n      return initialSizes\n    }, [initialSizes, isControlled, panelCount, sizesProp, uncontrolledSizes])\n\n    React.useEffect(() => {\n      if (isControlled) return\n      if (panelCount === 0) {\n        setUncontrolledSizes([])\n        return\n      }\n      if (uncontrolledSizes.length !== panelCount) {\n        setUncontrolledSizes(initialSizes)\n      }\n    }, [initialSizes, isControlled, panelCount, uncontrolledSizes.length])\n\n    const setSizesState = React.useCallback(\n      (nextSizes: number[]) => {\n        const normalized = normalizeSizes(nextSizes, panelCount)\n        if (!isControlled) {\n          setUncontrolledSizes(normalized)\n        }\n        onSizesChange?.(normalized)\n      },\n      [isControlled, onSizesChange, panelCount],\n    )\n\n    const constraintsRef = React.useRef(new Map<number, PanelConstraints>())\n\n    const registerPanel = React.useCallback(\n      (index: number, constraints: PanelConstraints) => {\n        constraintsRef.current.set(index, constraints)\n        return () => {\n          constraintsRef.current.delete(index)\n        }\n      },\n      [],\n    )\n\n    const resizeByPercent = React.useCallback(\n      (index: number, deltaPercent: number) => {\n        if (panelCount < 2) return\n        if (index < 0 || index >= panelCount - 1) return\n\n        const nextSizes = [...resolvedSizes]\n        const currentLeft = nextSizes[index] ?? 0\n        const currentRight = nextSizes[index + 1] ?? 0\n\n        const leftConstraints = constraintsRef.current.get(index) ?? {}\n        const rightConstraints = constraintsRef.current.get(index + 1) ?? {}\n\n        const leftMin = leftConstraints.minSize ?? 0\n        const leftMax = leftConstraints.maxSize ?? 100\n        const rightMin = rightConstraints.minSize ?? 0\n        const rightMax = rightConstraints.maxSize ?? 100\n\n        const minDelta = Math.max(leftMin - currentLeft, currentRight - rightMax)\n        const maxDelta = Math.min(leftMax - currentLeft, currentRight - rightMin)\n\n        const clampedDelta = clamp(deltaPercent, minDelta, maxDelta)\n        nextSizes[index] = currentLeft + clampedDelta\n        nextSizes[index + 1] = currentRight - clampedDelta\n\n        setSizesState(nextSizes)\n      },\n      [panelCount, resolvedSizes, setSizesState],\n    )\n\n    const resizeByDelta = React.useCallback(\n      (index: number, deltaPx: number) => {\n        if (containerSize <= 0) return\n        const deltaPercent = (deltaPx / containerSize) * 100\n        resizeByPercent(index, deltaPercent)\n      },\n      [containerSize, resizeByPercent],\n    )\n\n    const handleLayout = React.useCallback(\n      (event: LayoutChangeEvent) => {\n        const size =\n          direction === \"horizontal\"\n            ? event.nativeEvent.layout.width\n            : event.nativeEvent.layout.height\n        setContainerSize(size)\n        onLayout?.(event)\n      },\n      [direction, onLayout],\n    )\n\n    styles.useVariants({\n      direction,\n    })\n\n    return (\n      <ResizableContext.Provider\n        value={{\n          direction,\n          sizes: resolvedSizes,\n          panelCount,\n          containerSize,\n          setContainerSize,\n          registerPanel,\n          resizeByDelta,\n          resizeByPercent,\n        }}\n      >\n        <View\n          ref={ref}\n          role={Platform.OS === \"web\" ? \"group\" : undefined}\n          style={[styles.group, style]}\n          onLayout={handleLayout}\n          {...props}\n        >\n          {enhancedChildren}\n        </View>\n      </ResizableContext.Provider>\n    )\n  },\n)\n\nResizablePanelGroup.displayName = \"ResizablePanelGroup\"\n\nexport const ResizablePanel = React.forwardRef<View, ResizablePanelProps>(\n  ({ minSize, maxSize, style, _index, ...props }, ref) => {\n    const { direction, sizes, registerPanel } = useResizable()\n    const index = typeof _index === \"number\" ? _index : undefined\n\n    React.useEffect(() => {\n      if (index === undefined) return\n      return registerPanel(index, { minSize, maxSize })\n    }, [index, maxSize, minSize, registerPanel])\n\n    const size = index !== undefined ? sizes[index] : undefined\n    const sizeValue = size !== undefined ? (`${size}%` as const) : undefined\n    const sizeStyle: ViewStyle =\n      sizeValue !== undefined\n        ? direction === \"horizontal\"\n          ? { width: sizeValue }\n          : { height: sizeValue }\n        : { flex: 1 }\n\n    return (\n      <View\n        ref={ref}\n        style={[styles.panel, sizeStyle, style]}\n        {...props}\n      />\n    )\n  },\n)\n\nResizablePanel.displayName = \"ResizablePanel\"\n\nexport const ResizableHandle = React.forwardRef<View, ResizableHandleProps>(\n  ({ disabled, withHandle = false, keyboardStep = 2, style, _index, ...props }, ref) => {\n    const { direction, resizeByDelta, resizeByPercent, sizes } = useResizable()\n    const isDisabled = !!disabled\n    const index = typeof _index === \"number\" ? _index : -1\n    const isHorizontal = direction === \"horizontal\"\n\n    const lastDeltaRef = React.useRef(0)\n    const [dragging, setDragging] = React.useState(false)\n\n    const panResponder = React.useMemo(\n      () =>\n        PanResponder.create({\n          onStartShouldSetPanResponder: () => !isDisabled,\n          onMoveShouldSetPanResponder: () => !isDisabled,\n          onPanResponderGrant: () => {\n            lastDeltaRef.current = 0\n            setDragging(true)\n          },\n          onPanResponderMove: (_event, gestureState) => {\n            if (isDisabled) return\n            const deltaPx = isHorizontal ? gestureState.dx : gestureState.dy\n            const delta = deltaPx - lastDeltaRef.current\n            lastDeltaRef.current = deltaPx\n            resizeByDelta(index, delta)\n          },\n          onPanResponderRelease: () => {\n            lastDeltaRef.current = 0\n            setDragging(false)\n          },\n          onPanResponderTerminate: () => {\n            lastDeltaRef.current = 0\n            setDragging(false)\n          },\n        }),\n      [index, isDisabled, isHorizontal, resizeByDelta],\n    )\n\n    const handleKeyDown = React.useCallback(\n      (event: { key?: string; preventDefault?: () => void }) => {\n        if (Platform.OS !== \"web\" || isDisabled) return\n        const prevKey = isHorizontal ? \"ArrowLeft\" : \"ArrowUp\"\n        const nextKey = isHorizontal ? \"ArrowRight\" : \"ArrowDown\"\n        if (event.key === prevKey) {\n          event.preventDefault?.()\n          resizeByPercent(index, -keyboardStep)\n        }\n        if (event.key === nextKey) {\n          event.preventDefault?.()\n          resizeByPercent(index, keyboardStep)\n        }\n      },\n      [index, isDisabled, isHorizontal, keyboardStep, resizeByPercent],\n    )\n\n    styles.useVariants({\n      orientation: isHorizontal ? \"horizontal\" : \"vertical\",\n      dragging: dragging ? true : undefined,\n      disabled: isDisabled,\n    })\n\n    return (\n      <View\n        ref={ref}\n        role={Platform.OS === \"web\" ? \"separator\" : undefined}\n        aria-orientation={Platform.OS === \"web\" ? direction : undefined}\n        aria-disabled={Platform.OS === \"web\" ? isDisabled : undefined}\n        aria-valuenow={\n          Platform.OS === \"web\" && sizes[index] !== undefined\n            ? Math.round(sizes[index])\n            : undefined\n        }\n        accessibilityRole=\"adjustable\"\n        accessibilityState={{ disabled: isDisabled }}\n        style={[styles.handle, style]}\n        tabIndex={Platform.OS === \"web\" ? 0 : undefined}\n        // @ts-expect-error - onKeyDown is web-only\n        onKeyDown={Platform.OS === \"web\" ? handleKeyDown : undefined}\n        {...panResponder.panHandlers}\n        {...props}\n      >\n        {withHandle ? <View style={styles.handleGrip} /> : null}\n      </View>\n    )\n  },\n)\n\nResizableHandle.displayName = \"ResizableHandle\"\n\nconst styles = StyleSheet.create((theme) => ({\n  group: {\n    flexDirection: \"row\",\n    alignItems: \"stretch\",\n    width: \"100%\",\n    height: \"100%\",\n    variants: {\n      direction: {\n        horizontal: {\n          flexDirection: \"row\",\n        },\n        vertical: {\n          flexDirection: \"column\",\n        },\n      },\n    },\n  },\n  panel: {\n    flexGrow: 0,\n    flexShrink: 0,\n    overflow: \"hidden\",\n  },\n  handle: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    backgroundColor: \"transparent\",\n    variants: {\n      orientation: {\n        horizontal: {\n          width: 8,\n          height: \"100%\",\n        },\n        vertical: {\n          height: 8,\n          width: \"100%\",\n        },\n      },\n      dragging: {\n        true: {\n          backgroundColor: theme.colors.muted,\n        },\n      },\n      disabled: {\n        true: {\n          opacity: 0.5,\n        },\n      },\n    },\n  },\n  handleGrip: {\n    width: 2,\n    height: 24,\n    borderRadius: 999,\n    backgroundColor: theme.colors.border,\n    variants: {\n      orientation: {\n        horizontal: {},\n        vertical: {\n          width: 24,\n          height: 2,\n        },\n      },\n    },\n  },\n}))\n",
      "type": "registry:ui"
    }
  ]
}
