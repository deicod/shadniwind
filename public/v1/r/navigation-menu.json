{
  "name": "navigation-menu",
  "type": "registry:ui",
  "title": "Navigation Menu",
  "description": "Web-first navigation menu with trigger/content panels and keyboard support.",
  "registryDependencies": [
    "@shadniwind/tokens",
    "@shadniwind/portal",
    "@shadniwind/positioning",
    "@shadniwind/overlay",
    "@shadniwind/roving-focus",
    "@shadniwind/press"
  ],
  "files": [
    {
      "path": "components/ui/navigation-menu.tsx",
      "content": "import * as React from \"react\"\nimport {\n  Platform,\n  Pressable,\n  type PressableProps,\n  type StyleProp,\n  Text,\n  type TextStyle,\n  View,\n  type ViewProps,\n} from \"react-native\"\nimport { StyleSheet } from \"react-native-unistyles\"\nimport { DismissLayer } from \"../primitives/overlay/index\"\nimport { Portal } from \"../primitives/portal/index\"\nimport {\n  type Placement,\n  usePositioning,\n} from \"../primitives/positioning/index\"\nimport { composeEventHandlers } from \"../primitives/press/index\"\nimport * as RovingFocusGroup from \"../primitives/roving-focus/index\"\n\ntype NavigationMenuContextValue = {\n  openValue?: string\n  setOpenValue: (value?: string) => void\n  activeValue?: string\n  setActiveValue: (value: string) => void\n}\n\nconst NavigationMenuContext = React.createContext<\n  NavigationMenuContextValue | undefined\n>(undefined)\n\nfunction useNavigationMenu() {\n  const context = React.useContext(NavigationMenuContext)\n  if (!context) {\n    throw new Error(\"NavigationMenu components must be used within NavigationMenu\")\n  }\n  return context\n}\n\ntype NavigationMenuItemContextValue = {\n  value: string\n  open: boolean\n  setOpen: (open: boolean) => void\n  triggerRef: React.RefObject<View | null>\n  contentRef: React.RefObject<View | null>\n  triggerId: string\n  contentId: string\n}\n\nconst NavigationMenuItemContext = React.createContext<\n  NavigationMenuItemContextValue | undefined\n>(undefined)\n\nfunction useNavigationMenuItem() {\n  const context = React.useContext(NavigationMenuItemContext)\n  if (!context) {\n    throw new Error(\n      \"NavigationMenu components must be used within NavigationMenuItem\",\n    )\n  }\n  return context\n}\n\nexport type NavigationMenuProps = ViewProps & {\n  value?: string\n  defaultValue?: string\n  onValueChange?: (value?: string) => void\n}\n\n/**\n * Navigation menu component with web-first interactions.\n *\n * Web: Supports roving focus across triggers and arrow-key open/close.\n * Native: Basic press-to-toggle behavior.\n *\n * Limitations:\n * - Content renders via portal and positioning (not a full Radix viewport).\n * - Native navigation patterns differ and may need app-specific wiring.\n */\nexport const NavigationMenu = React.forwardRef<View, NavigationMenuProps>(\n  ({ value: valueProp, defaultValue, onValueChange, style, ...props }, ref) => {\n    const [openValue, setOpenValueState] = React.useState<string | undefined>(\n      defaultValue,\n    )\n    const [activeValue, setActiveValueState] = React.useState<string | undefined>(\n      valueProp ?? defaultValue,\n    )\n    const isControlled = valueProp !== undefined\n    const currentOpenValue = isControlled ? valueProp : openValue\n\n    const handleOpenValueChange = React.useCallback(\n      (nextValue?: string) => {\n        if (!isControlled) {\n          setOpenValueState(nextValue)\n        }\n        onValueChange?.(nextValue)\n      },\n      [isControlled, onValueChange],\n    )\n\n    const handleActiveValueChange = React.useCallback(\n      (nextValue: string) => {\n        setActiveValueState(nextValue)\n        if (currentOpenValue !== undefined) {\n          handleOpenValueChange(nextValue)\n        }\n      },\n      [currentOpenValue, handleOpenValueChange],\n    )\n\n    React.useEffect(() => {\n      if (currentOpenValue !== undefined) {\n        setActiveValueState(currentOpenValue)\n      }\n    }, [currentOpenValue])\n\n    return (\n      <NavigationMenuContext.Provider\n        value={{\n          openValue: currentOpenValue,\n          setOpenValue: handleOpenValueChange,\n          activeValue,\n          setActiveValue: handleActiveValueChange,\n        }}\n      >\n        <View\n          ref={ref}\n          role={Platform.OS === \"web\" ? \"navigation\" : undefined}\n          style={[styles.root, style]}\n          {...props}\n        />\n      </NavigationMenuContext.Provider>\n    )\n  },\n)\n\nNavigationMenu.displayName = \"NavigationMenu\"\n\nexport type NavigationMenuListProps = ViewProps\n\nexport const NavigationMenuList = React.forwardRef<View, NavigationMenuListProps>(\n  ({ style, ...props }, ref) => {\n    const { activeValue, setActiveValue } = useNavigationMenu()\n\n    if (Platform.OS === \"web\") {\n      return (\n        <RovingFocusGroup.RovingFocusGroup\n          ref={ref}\n          orientation=\"horizontal\"\n          value={activeValue}\n          onValueChange={setActiveValue}\n          loop\n          style={[styles.list, style]}\n          {...props}\n        />\n      )\n    }\n\n    return <View ref={ref} style={[styles.list, style]} {...props} />\n  },\n)\n\nNavigationMenuList.displayName = \"NavigationMenuList\"\n\nexport type NavigationMenuItemProps = ViewProps & {\n  value?: string\n}\n\nexport const NavigationMenuItem = React.forwardRef<\n  View,\n  NavigationMenuItemProps\n>(({ value, style, ...props }, ref) => {\n  const { openValue, setOpenValue, setActiveValue } = useNavigationMenu()\n  const generatedId = React.useId()\n  const itemValue = value ?? generatedId\n  const open = openValue === itemValue\n  const triggerRef = React.useRef<View>(null)\n  const contentRef = React.useRef<View>(null)\n  const triggerId = React.useId()\n  const contentId = React.useId()\n\n  const setOpen = React.useCallback(\n    (nextOpen: boolean) => {\n      const nextValue = nextOpen ? itemValue : undefined\n      setOpenValue(nextValue)\n      if (nextOpen) {\n        setActiveValue(itemValue)\n      }\n    },\n    [itemValue, setActiveValue, setOpenValue],\n  )\n\n  return (\n    <NavigationMenuItemContext.Provider\n      value={{\n        value: itemValue,\n        open,\n        setOpen,\n        triggerRef,\n        contentRef,\n        triggerId,\n        contentId,\n      }}\n    >\n      <View ref={ref} style={[styles.item, style]} {...props} />\n    </NavigationMenuItemContext.Provider>\n  )\n})\n\nNavigationMenuItem.displayName = \"NavigationMenuItem\"\n\nexport type NavigationMenuTriggerProps = PressableProps & {\n  asChild?: boolean\n  onKeyDown?: (event: unknown) => void\n}\n\nexport const NavigationMenuTrigger = React.forwardRef<\n  React.ComponentRef<typeof Pressable>,\n  NavigationMenuTriggerProps\n>(\n  (\n    {\n      children,\n      asChild,\n      onPress,\n      onHoverIn,\n      onHoverOut,\n      onFocus,\n      onBlur,\n      onKeyDown,\n      disabled,\n      style,\n      ...props\n    },\n    ref,\n  ) => {\n    const { openValue, setActiveValue } = useNavigationMenu()\n    const { open, setOpen, triggerRef, triggerId, contentId, value } =\n      useNavigationMenuItem()\n    const isDisabled = !!disabled\n    const isAnyOpen = openValue !== undefined\n\n    const variantStyles = styles.useVariants({\n      open,\n      disabled: isDisabled,\n    })\n\n    const handlePress = React.useCallback(\n      (event: unknown) => {\n        if (isDisabled) return\n        setOpen(!open)\n        // @ts-expect-error - React Native event type\n        onPress?.(event)\n      },\n      [isDisabled, onPress, open, setOpen],\n    )\n\n    const handleHoverIn = React.useCallback(\n      (event: unknown) => {\n        if (isDisabled) return\n        if (Platform.OS === \"web\" && isAnyOpen) {\n          setActiveValue(value)\n        }\n        // @ts-expect-error - React Native event type\n        onHoverIn?.(event)\n      },\n      [isAnyOpen, isDisabled, onHoverIn, setActiveValue, value],\n    )\n\n    const handleHoverOut = React.useCallback(\n      (event: unknown) => {\n        if (isDisabled) return\n        // @ts-expect-error - React Native event type\n        onHoverOut?.(event)\n      },\n      [isDisabled, onHoverOut],\n    )\n\n    const handleFocus = React.useCallback(\n      (event: unknown) => {\n        if (isDisabled) return\n        setActiveValue(value)\n        // @ts-expect-error - React Native event type\n        onFocus?.(event)\n      },\n      [isDisabled, onFocus, setActiveValue, value],\n    )\n\n    const handleBlur = React.useCallback(\n      (event: unknown) => {\n        if (isDisabled) return\n        // @ts-expect-error - React Native event type\n        onBlur?.(event)\n      },\n      [isDisabled, onBlur],\n    )\n\n    const handleKeyDown = React.useCallback(\n      // biome-ignore lint/suspicious/noExplicitAny: Web-only keyboard event type\n      (event: any) => {\n        if (Platform.OS !== \"web\" || isDisabled) return\n        if (event.key === \"Enter\" || event.key === \" \") {\n          event.preventDefault()\n          setOpen(true)\n        } else if (event.key === \"ArrowDown\") {\n          event.preventDefault()\n          setOpen(true)\n        } else if (event.key === \"ArrowUp\") {\n          event.preventDefault()\n          setOpen(true)\n        } else if (event.key === \"Escape\") {\n          event.preventDefault()\n          setOpen(false)\n        }\n        onKeyDown?.(event)\n      },\n      [isDisabled, onKeyDown, setOpen],\n    )\n\n    const setTriggerRef = React.useCallback(\n      (node: View | null) => {\n        triggerRef.current = node\n        if (typeof ref === \"function\") {\n          ref(node)\n        } else if (ref) {\n          ;(ref as { current: View | null }).current = node\n        }\n      },\n      [ref, triggerRef],\n    )\n\n    if (asChild && React.isValidElement(children)) {\n      const child = children as React.ReactElement<{\n        onPress?: (event: unknown) => void\n        onHoverIn?: (event: unknown) => void\n        onHoverOut?: (event: unknown) => void\n        onFocus?: (event: unknown) => void\n        onBlur?: (event: unknown) => void\n        onKeyDown?: (event: unknown) => void\n      }>\n      const childOnPress = isDisabled ? undefined : child.props.onPress\n      const childOnHoverIn = isDisabled ? undefined : child.props.onHoverIn\n      const childOnHoverOut = isDisabled ? undefined : child.props.onHoverOut\n      const childOnFocus = isDisabled ? undefined : child.props.onFocus\n      const childOnBlur = isDisabled ? undefined : child.props.onBlur\n      const childOnKeyDown = isDisabled ? undefined : child.props.onKeyDown\n      // biome-ignore lint/suspicious/noExplicitAny: Cloning logic\n      const trigger = React.cloneElement(child as React.ReactElement<any>, {\n        ref: setTriggerRef,\n        onPress: composeEventHandlers(childOnPress, handlePress),\n        onHoverIn: composeEventHandlers(childOnHoverIn, handleHoverIn),\n        onHoverOut: composeEventHandlers(childOnHoverOut, handleHoverOut),\n        onFocus: composeEventHandlers(childOnFocus, handleFocus),\n        onBlur: composeEventHandlers(childOnBlur, handleBlur),\n        onKeyDown: composeEventHandlers(childOnKeyDown, handleKeyDown),\n        role: Platform.OS === \"web\" ? \"button\" : undefined,\n        \"aria-expanded\": Platform.OS === \"web\" ? open : undefined,\n        \"aria-controls\": Platform.OS === \"web\" ? contentId : undefined,\n        \"aria-haspopup\": Platform.OS === \"web\" ? \"menu\" : undefined,\n        accessibilityRole: \"button\",\n        accessibilityState: {\n          expanded: open,\n          disabled: isDisabled,\n        },\n        disabled: isDisabled,\n        nativeID: triggerId,\n        ...props,\n      })\n\n      return (\n        <RovingFocusGroup.RovingFocusItem\n          value={value}\n          disabled={isDisabled}\n          asChild\n        >\n          {trigger}\n        </RovingFocusGroup.RovingFocusItem>\n      )\n    }\n\n    return (\n      <RovingFocusGroup.RovingFocusItem value={value} disabled={isDisabled} asChild>\n        <Pressable\n          ref={setTriggerRef}\n          role={Platform.OS === \"web\" ? \"button\" : undefined}\n          aria-expanded={Platform.OS === \"web\" ? open : undefined}\n          aria-controls={Platform.OS === \"web\" ? contentId : undefined}\n          aria-haspopup={Platform.OS === \"web\" ? \"menu\" : undefined}\n          accessibilityRole=\"button\"\n          accessibilityState={{\n            expanded: open,\n            disabled: isDisabled,\n          }}\n          disabled={isDisabled}\n          nativeID={triggerId}\n          onPress={handlePress}\n          onHoverIn={handleHoverIn}\n          onHoverOut={handleHoverOut}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          // @ts-expect-error - onKeyDown is web-only\n          onKeyDown={Platform.OS === \"web\" ? handleKeyDown : undefined}\n          style={({ pressed }) =>\n            [\n              styles.trigger,\n              variantStyles,\n              pressed && !isDisabled && styles.triggerPressed,\n              typeof style === \"function\" ? style({ pressed }) : style,\n              // biome-ignore lint/suspicious/noExplicitAny: Complex style array with variants requires type assertion\n            ] as any\n          }\n          {...props}\n        >\n          {typeof children === \"string\" || typeof children === \"number\" ? (\n            <Text style={styles.triggerText}>{children}</Text>\n          ) : (\n            children\n          )}\n        </Pressable>\n      </RovingFocusGroup.RovingFocusItem>\n    )\n  },\n)\n\nNavigationMenuTrigger.displayName = \"NavigationMenuTrigger\"\n\nexport type NavigationMenuContentProps = ViewProps & {\n  side?: Placement\n  sideOffset?: number\n  align?: \"start\" | \"center\" | \"end\"\n  alignOffset?: number\n  avoidCollisions?: boolean\n  dismissable?: boolean\n  onDismiss?: () => void\n}\n\nexport const NavigationMenuContent = React.forwardRef<\n  View,\n  NavigationMenuContentProps\n>(\n  (\n    {\n      children,\n      side = \"bottom\",\n      sideOffset = 8,\n      align = \"start\",\n      alignOffset = 0,\n      avoidCollisions = true,\n      dismissable = true,\n      onDismiss,\n      style,\n      ...props\n    },\n    ref,\n  ) => {\n    const { open, setOpen, triggerRef, contentRef, triggerId, contentId } =\n      useNavigationMenuItem()\n\n    const actualPlacement = align === \"center\" ? side : `${side}-${align}`\n\n    const { position, isPositioned } = usePositioning({\n      anchorRef: triggerRef,\n      contentRef,\n      placement: actualPlacement as Placement,\n      offset: sideOffset,\n      alignOffset,\n      flip: avoidCollisions,\n      open,\n    })\n\n    const handleDismiss = React.useCallback(() => {\n      setOpen(false)\n      onDismiss?.()\n    }, [onDismiss, setOpen])\n\n    const setContentRef = React.useCallback(\n      (node: View | null) => {\n        contentRef.current = node\n        if (typeof ref === \"function\") {\n          ref(node)\n        } else if (ref) {\n          ;(ref as { current: View | null }).current = node\n        }\n      },\n      [contentRef, ref],\n    )\n\n    if (!open) return null\n\n    return (\n      <Portal>\n        <DismissLayer\n          onDismiss={handleDismiss}\n          dismissable={dismissable}\n          scrim={false}\n          scrimStyle={styles.overlay}\n        >\n          <View style={styles.container}>\n            <View\n              ref={setContentRef}\n              nativeID={contentId}\n              role={Platform.OS === \"web\" ? \"region\" : undefined}\n              aria-labelledby={Platform.OS === \"web\" ? triggerId : undefined}\n              style={[\n                styles.content,\n                {\n                  position: \"absolute\",\n                  opacity: isPositioned ? 1 : 0,\n                  top: position.top,\n                  left: position.left,\n                },\n                style,\n              ]}\n              {...props}\n            >\n              {children}\n            </View>\n          </View>\n        </DismissLayer>\n      </Portal>\n    )\n  },\n)\n\nNavigationMenuContent.displayName = \"NavigationMenuContent\"\n\nexport type NavigationMenuLinkProps = PressableProps & {\n  asChild?: boolean\n  active?: boolean\n  closeOnSelect?: boolean\n  textStyle?: StyleProp<TextStyle>\n}\n\nexport const NavigationMenuLink = React.forwardRef<\n  React.ComponentRef<typeof Pressable>,\n  NavigationMenuLinkProps\n>(\n  (\n    {\n      children,\n      asChild,\n      active = false,\n      closeOnSelect = true,\n      disabled,\n      style,\n      textStyle,\n      onPress,\n      ...props\n    },\n    ref,\n  ) => {\n    const menuItemContext = React.useContext(NavigationMenuItemContext)\n    const isDisabled = !!disabled\n    const variantStyles = styles.useVariants({\n      active,\n      disabled: isDisabled,\n    })\n\n    const handlePress = React.useCallback(\n      (event: unknown) => {\n        if (isDisabled) return\n        // @ts-expect-error - React Native event type\n        onPress?.(event)\n        if (closeOnSelect && menuItemContext?.open) {\n          menuItemContext.setOpen(false)\n        }\n      },\n      [closeOnSelect, isDisabled, menuItemContext, onPress],\n    )\n\n    if (asChild && React.isValidElement(children)) {\n      const child = children as React.ReactElement<{\n        onPress?: (event: unknown) => void\n      }>\n      const childOnPress = isDisabled ? undefined : child.props.onPress\n      // biome-ignore lint/suspicious/noExplicitAny: Cloning logic\n      return React.cloneElement(child as React.ReactElement<any>, {\n        ref,\n        onPress: composeEventHandlers(childOnPress, handlePress),\n        role: Platform.OS === \"web\" ? \"link\" : undefined,\n        accessibilityRole: \"link\",\n        accessibilityState: {\n          disabled: isDisabled,\n        },\n        disabled: isDisabled,\n        ...props,\n      })\n    }\n\n    return (\n      <Pressable\n        ref={ref}\n        role={Platform.OS === \"web\" ? \"link\" : undefined}\n        accessibilityRole=\"link\"\n        accessibilityState={{\n          disabled: isDisabled,\n        }}\n        disabled={isDisabled}\n        onPress={handlePress}\n        style={({ pressed }) =>\n          [\n            styles.link,\n            variantStyles,\n            pressed && !isDisabled && styles.linkPressed,\n            typeof style === \"function\" ? style({ pressed }) : style,\n            // biome-ignore lint/suspicious/noExplicitAny: Complex style array with variants requires type assertion\n          ] as any\n        }\n        {...props}\n      >\n        {typeof children === \"string\" || typeof children === \"number\" ? (\n          <Text style={[styles.linkText, textStyle]}>{children}</Text>\n        ) : (\n          children\n        )}\n      </Pressable>\n    )\n  },\n)\n\nNavigationMenuLink.displayName = \"NavigationMenuLink\"\n\nexport type NavigationMenuViewportProps = ViewProps\n\nexport const NavigationMenuViewport = React.forwardRef<\n  React.ComponentRef<typeof View>,\n  NavigationMenuViewportProps\n>(({ style, ...props }, ref) => {\n  return <View ref={ref} style={[styles.viewport, style]} {...props} />\n})\n\nNavigationMenuViewport.displayName = \"NavigationMenuViewport\"\n\nexport type NavigationMenuIndicatorProps = ViewProps\n\nexport const NavigationMenuIndicator = React.forwardRef<\n  React.ComponentRef<typeof View>,\n  NavigationMenuIndicatorProps\n>(({ style, ...props }, ref) => {\n  return <View ref={ref} style={[styles.indicator, style]} {...props} />\n})\n\nNavigationMenuIndicator.displayName = \"NavigationMenuIndicator\"\n\nconst styles = StyleSheet.create((theme) => ({\n  root: {\n    position: \"relative\",\n    width: \"100%\",\n  },\n  list: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: theme.spacing[1],\n  },\n  item: {},\n  trigger: {\n    minHeight: theme.spacing[8],\n    paddingHorizontal: theme.spacing[3],\n    paddingVertical: theme.spacing[2],\n    borderRadius: theme.radius.md,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: theme.spacing[1],\n    variants: {\n      open: {\n        true: {\n          backgroundColor: theme.colors.muted,\n        },\n      },\n      disabled: {\n        true: {\n          opacity: 0.5,\n        },\n      },\n    },\n  },\n  triggerPressed: {\n    backgroundColor: theme.colors.muted,\n  },\n  triggerText: {\n    fontSize: theme.typography.sizes.sm,\n    lineHeight: theme.typography.lineHeights.sm,\n    color: theme.colors.foreground,\n  },\n  container: {\n    flex: 1,\n  },\n  overlay: {\n    backgroundColor: \"transparent\",\n  },\n  content: {\n    zIndex: 50,\n    minWidth: 220,\n    borderRadius: theme.radius.md,\n    borderWidth: 1,\n    borderColor: theme.colors.border,\n    backgroundColor: theme.colors.popover,\n    padding: theme.spacing[4],\n    shadowColor: theme.colors.foreground,\n    shadowOpacity: 0.1,\n    shadowRadius: 8,\n    elevation: 3,\n  },\n  link: {\n    paddingVertical: theme.spacing[2],\n    paddingHorizontal: theme.spacing[3],\n    borderRadius: theme.radius.md,\n    variants: {\n      active: {\n        true: {\n          backgroundColor: theme.colors.muted,\n        },\n      },\n      disabled: {\n        true: {\n          opacity: 0.5,\n        },\n      },\n    },\n  },\n  linkPressed: {\n    backgroundColor: theme.colors.muted,\n  },\n  linkText: {\n    fontSize: theme.typography.sizes.sm,\n    lineHeight: theme.typography.lineHeights.sm,\n    color: theme.colors.foreground,\n  },\n  viewport: {\n    marginTop: theme.spacing[2],\n    borderRadius: theme.radius.md,\n    borderWidth: 1,\n    borderColor: theme.colors.border,\n    backgroundColor: theme.colors.popover,\n    padding: theme.spacing[3],\n  },\n  indicator: {\n    height: 2,\n    borderRadius: 999,\n    backgroundColor: theme.colors.primary,\n  },\n}))\n",
      "type": "registry:ui"
    }
  ]
}
