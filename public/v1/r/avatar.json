{
  "name": "avatar",
  "type": "registry:ui",
  "title": "Avatar",
  "description": "Avatar with image loading states and fallback initials.",
  "registryDependencies": [
    "tokens"
  ],
  "files": [
    {
      "path": "components/ui/avatar.tsx",
      "content": "import * as React from \"react\"\nimport {\n  Image,\n  Text,\n  View,\n  type ImageProps,\n  type ImageStyle,\n  type StyleProp,\n  type TextStyle,\n  type ViewProps,\n  type ViewStyle,\n} from \"react-native\"\nimport { StyleSheet } from \"react-native-unistyles\"\n\ntype AvatarStatus = \"idle\" | \"loading\" | \"loaded\" | \"error\"\n\nexport type AvatarSize = \"sm\" | \"md\" | \"lg\"\n\nexport type AvatarProps = Omit<ViewProps, \"style\"> & {\n  size?: AvatarSize\n  style?: StyleProp<ViewStyle>\n}\n\nexport type AvatarImageProps = Omit<ImageProps, \"style\"> & {\n  style?: StyleProp<ImageStyle>\n}\n\nexport type AvatarFallbackProps = Omit<ViewProps, \"style\"> & {\n  delayMs?: number\n  name?: string\n  style?: StyleProp<ViewStyle>\n  textStyle?: StyleProp<TextStyle>\n}\n\ntype AvatarContextValue = {\n  status: AvatarStatus\n  setStatus: React.Dispatch<React.SetStateAction<AvatarStatus>>\n  size: AvatarSize\n}\n\nconst DEFAULT_SIZE: AvatarSize = \"md\"\n\nconst AvatarContext = React.createContext<AvatarContextValue | null>(null)\n\nconst avatarStyles = StyleSheet.create((theme) => ({\n  root: {\n    position: \"relative\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderRadius: 9999,\n    overflow: \"hidden\",\n    backgroundColor: theme.colors.muted,\n    variants: {\n      size: {\n        sm: {\n          width: 32,\n          height: 32,\n        },\n        md: {\n          width: 40,\n          height: 40,\n        },\n        lg: {\n          width: 56,\n          height: 56,\n        },\n      },\n    },\n  },\n  image: {\n    width: \"100%\",\n    height: \"100%\",\n    variants: {\n      imageVisible: {\n        true: { opacity: 1 },\n        false: { opacity: 0 },\n      },\n    },\n  },\n  fallback: {\n    width: \"100%\",\n    height: \"100%\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    backgroundColor: theme.colors.muted,\n  },\n  fallbackText: {\n    fontSize: theme.typography.sizes.sm,\n    lineHeight: theme.typography.lineHeights.sm,\n    fontWeight: theme.typography.weights.semibold,\n    color: theme.colors.mutedForeground,\n    variants: {\n      size: {\n        sm: {\n          fontSize: theme.typography.sizes.xs,\n          lineHeight: theme.typography.lineHeights.xs,\n        },\n        md: {\n          fontSize: theme.typography.sizes.sm,\n          lineHeight: theme.typography.lineHeights.sm,\n        },\n        lg: {\n          fontSize: theme.typography.sizes.md,\n          lineHeight: theme.typography.lineHeights.md,\n        },\n      },\n    },\n  },\n}))\n\nconst getInitials = (name: string) => {\n  const trimmed = name.trim()\n  if (!trimmed) {\n    return \"\"\n  }\n  const parts = trimmed.split(/\\s+/)\n  return parts\n    .slice(0, 2)\n    .map((part) => part[0])\n    .join(\"\")\n    .toUpperCase()\n}\n\nexport const Avatar = React.forwardRef<View, AvatarProps>(\n  ({ size = DEFAULT_SIZE, style, children, ...props }, ref) => {\n    const [status, setStatus] = React.useState<AvatarStatus>(\"idle\")\n    const variantStyles = avatarStyles.useVariants({ size }) as\n      | typeof avatarStyles\n      | undefined\n    const styles = variantStyles ?? avatarStyles\n\n    return (\n      <AvatarContext.Provider value={{ status, setStatus, size }}>\n        <View ref={ref} style={[styles.root, style]} {...props}>\n          {children}\n        </View>\n      </AvatarContext.Provider>\n    )\n  },\n)\n\nAvatar.displayName = \"Avatar\"\n\ntype AvatarImageRef = React.ElementRef<typeof Image>\n\nexport const AvatarImage = React.forwardRef<AvatarImageRef, AvatarImageProps>(\n  (\n    {\n      style,\n      source,\n      resizeMode = \"cover\",\n      onLoadStart,\n      onLoad,\n      onError,\n      ...props\n    },\n    ref,\n  ) => {\n    const context = React.useContext(AvatarContext)\n    const size = context?.size ?? DEFAULT_SIZE\n    const status = context?.status ?? \"loaded\"\n    const setStatus = context?.setStatus\n\n    const variantStyles = avatarStyles.useVariants({\n      size,\n      imageVisible: status === \"loaded\",\n    }) as typeof avatarStyles | undefined\n    const styles = variantStyles ?? avatarStyles\n\n    React.useEffect(() => {\n      if (!setStatus) {\n        return\n      }\n      setStatus(\"loading\")\n    }, [setStatus, source])\n\n    const handleLoadStart: NonNullable<ImageProps[\"onLoadStart\"]> = () => {\n      setStatus?.(\"loading\")\n      onLoadStart?.()\n    }\n\n    const handleLoad: NonNullable<ImageProps[\"onLoad\"]> = (event) => {\n      setStatus?.(\"loaded\")\n      onLoad?.(event)\n    }\n\n    const handleError: NonNullable<ImageProps[\"onError\"]> = (event) => {\n      setStatus?.(\"error\")\n      onError?.(event)\n    }\n\n    return (\n      <Image\n        ref={ref}\n        source={source}\n        resizeMode={resizeMode}\n        style={[styles.image, style]}\n        onLoadStart={handleLoadStart}\n        onLoad={handleLoad}\n        onError={handleError}\n        {...props}\n      />\n    )\n  },\n)\n\nAvatarImage.displayName = \"AvatarImage\"\n\ntype AvatarFallbackRef = React.ElementRef<typeof View>\n\nexport const AvatarFallback = React.forwardRef<AvatarFallbackRef, AvatarFallbackProps>(\n  ({ delayMs = 0, name, style, textStyle, children, ...props }, ref) => {\n    const context = React.useContext(AvatarContext)\n    const size = context?.size ?? DEFAULT_SIZE\n    const status = context?.status ?? \"idle\"\n    const [visible, setVisible] = React.useState(delayMs === 0)\n\n    const variantStyles = avatarStyles.useVariants({ size }) as\n      | typeof avatarStyles\n      | undefined\n    const styles = variantStyles ?? avatarStyles\n\n    React.useEffect(() => {\n      if (delayMs === 0) {\n        setVisible(true)\n        return\n      }\n      const timer = setTimeout(() => setVisible(true), delayMs)\n      return () => clearTimeout(timer)\n    }, [delayMs])\n\n    if (status === \"loaded\" || !visible) {\n      return null\n    }\n\n    const content = children ?? (name ? getInitials(name) : null)\n    const isTextContent = typeof content === \"string\" || typeof content === \"number\"\n\n    return (\n      <View ref={ref} style={[styles.fallback, style]} {...props}>\n        {isTextContent ? (\n          <Text style={[styles.fallbackText, textStyle]}>{content}</Text>\n        ) : (\n          content\n        )}\n      </View>\n    )\n  },\n)\n\nAvatarFallback.displayName = \"AvatarFallback\"\n",
      "type": "registry:ui"
    }
  ]
}
