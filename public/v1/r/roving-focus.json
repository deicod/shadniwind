{
  "name": "roving-focus",
  "type": "registry:lib",
  "title": "Roving Focus",
  "description": "Roving Focus primitive for managing focus in a list or grid.",
  "files": [
    {
      "path": "lib/roving-focus/types.ts",
      "content": "import type { ViewProps } from \"react-native\"\n\nexport type Orientation = \"horizontal\" | \"vertical\" | \"both\"\nexport type Direction = \"ltr\" | \"rtl\"\n\nexport interface RovingFocusGroupProps extends ViewProps {\n  /**\n   * The orientation of the group.\n   * @default \"vertical\"\n   */\n  orientation?: Orientation\n\n  /**\n   * The direction of the group (for RTL support).\n   * @default \"ltr\"\n   */\n  dir?: Direction\n\n  /**\n   * Whether keyboard navigation should loop around.\n   * @default false\n   */\n  loop?: boolean\n\n  /**\n   * The value of the currently focused item (controlled).\n   */\n  value?: string\n\n  /**\n   * The default value of the focused item (uncontrolled).\n   */\n  defaultValue?: string\n\n  /**\n   * Callback when the focused item changes.\n   */\n  onValueChange?: (value: string) => void\n\n  asChild?: boolean\n}\n\nexport interface RovingFocusItemProps extends ViewProps {\n  /**\n   * A unique value for the item.\n   */\n  value: string\n\n  /**\n   * Whether the item is disabled.\n   * @default false\n   */\n  disabled?: boolean\n\n  asChild?: boolean\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/roving-focus/roving-focus.tsx",
      "content": "import { Platform } from \"react-native\"\nimport * as RovingFocusNative from \"./roving-focus.native.js\"\nimport * as RovingFocusWeb from \"./roving-focus.web.js\"\n\nexport const RovingFocusGroup =\n  Platform.OS === \"web\"\n    ? RovingFocusWeb.RovingFocusGroup\n    : RovingFocusNative.RovingFocusGroup\nexport const RovingFocusItem =\n  Platform.OS === \"web\"\n    ? RovingFocusWeb.RovingFocusItem\n    : RovingFocusNative.RovingFocusItem\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/roving-focus/roving-focus.web.tsx",
      "content": "import * as React from \"react\"\nimport { View } from \"react-native\"\nimport type { RovingFocusGroupProps, RovingFocusItemProps } from \"./types.js\"\n\nconst ITEM_DATA_ATTR = \"data-roving-focus-item\"\nconst VALUE_DATA_ATTR = \"data-roving-focus-value\"\n\nconst RovingFocusContext = React.createContext<{\n  value?: string\n  onValueChange: (value: string) => void\n  orientation?: \"horizontal\" | \"vertical\" | \"both\"\n  dir?: \"ltr\" | \"rtl\"\n  loop?: boolean\n} | null>(null)\n\nfunction getNextItem(\n  current: HTMLElement,\n  items: HTMLElement[],\n  dir: \"next\" | \"prev\",\n  loop: boolean,\n): HTMLElement | null {\n  const index = items.indexOf(current)\n  if (index === -1) return null\n\n  let nextIndex = dir === \"next\" ? index + 1 : index - 1\n\n  if (loop) {\n    if (nextIndex < 0) nextIndex = items.length - 1\n    else if (nextIndex >= items.length) nextIndex = 0\n  }\n\n  // Clamp if not looping\n  if (nextIndex < 0 || nextIndex >= items.length) return null\n\n  return items[nextIndex]\n}\n\nexport const RovingFocusGroup = React.forwardRef<View, RovingFocusGroupProps>(\n  (\n    {\n      orientation = \"vertical\",\n      dir = \"ltr\",\n      loop = false,\n      value: valueProp,\n      defaultValue,\n      onValueChange,\n      children,\n      style,\n      ...props\n    },\n    ref,\n  ) => {\n    const [value, setValue] = React.useState(valueProp ?? defaultValue)\n    const isControlled = valueProp !== undefined\n    const currentValue = isControlled ? valueProp : value\n\n    const handleValueChange = React.useCallback(\n      (newValue: string) => {\n        if (!isControlled) {\n          setValue(newValue)\n        }\n        onValueChange?.(newValue)\n      },\n      [isControlled, onValueChange],\n    )\n\n    const handleKeyDown = (e: React.KeyboardEvent) => {\n      const container = e.currentTarget as HTMLElement\n      const items = Array.from(\n        container.querySelectorAll(\n          `[${ITEM_DATA_ATTR}]:not([aria-disabled=\"true\"]):not([disabled])`,\n        ),\n      ) as HTMLElement[]\n\n      if (items.length === 0) return\n\n      const target = e.target as HTMLElement\n      const currentItem = target.closest(`[${ITEM_DATA_ATTR}]`) as HTMLElement\n\n      if (!currentItem) return\n\n      const isRtl = dir === \"rtl\"\n      const isVertical = orientation === \"vertical\" || orientation === \"both\"\n      const isHorizontal =\n        orientation === \"horizontal\" || orientation === \"both\"\n\n      let nextItem: HTMLElement | null = null\n\n      if (e.key === \"ArrowDown\" && isVertical) {\n        nextItem = getNextItem(currentItem, items, \"next\", loop)\n      } else if (e.key === \"ArrowUp\" && isVertical) {\n        nextItem = getNextItem(currentItem, items, \"prev\", loop)\n      } else if (e.key === \"ArrowRight\" && isHorizontal) {\n        nextItem = getNextItem(\n          currentItem,\n          items,\n          isRtl ? \"prev\" : \"next\",\n          loop,\n        )\n      } else if (e.key === \"ArrowLeft\" && isHorizontal) {\n        nextItem = getNextItem(\n          currentItem,\n          items,\n          isRtl ? \"next\" : \"prev\",\n          loop,\n        )\n      } else if (e.key === \"Home\") {\n        nextItem = items[0]\n      } else if (e.key === \"End\") {\n        nextItem = items[items.length - 1]\n      }\n\n      if (nextItem) {\n        e.preventDefault()\n        handleValueChange(nextItem.getAttribute(VALUE_DATA_ATTR) || \"\")\n        nextItem.focus()\n      }\n    }\n\n    const internalRef = React.useRef<HTMLElement | null>(null)\n    const setRef = React.useCallback(\n      (node: View | null) => {\n        internalRef.current = node as unknown as HTMLElement\n        if (typeof ref === \"function\") {\n          ref(node)\n        } else if (ref) {\n          ;(ref as { current: View | null }).current = node\n        }\n      },\n      [ref],\n    )\n\n    React.useEffect(() => {\n      if (currentValue !== undefined) return\n      const container = internalRef.current\n      if (!container) return\n\n      const items = Array.from(\n        container.querySelectorAll(\n          `[${ITEM_DATA_ATTR}]:not([aria-disabled=\"true\"]):not([disabled])`,\n        ),\n      ) as HTMLElement[]\n\n      if (items.length > 0) {\n        const firstItemValue = items[0].getAttribute(VALUE_DATA_ATTR)\n        if (firstItemValue) {\n          handleValueChange(firstItemValue)\n        }\n      }\n    }, [currentValue, handleValueChange])\n    // If we run when undefined, it will set it, then re-render with defined value.\n\n    return (\n      <RovingFocusContext.Provider\n        value={{\n          value: currentValue,\n          onValueChange: handleValueChange,\n          orientation,\n          dir,\n          loop,\n        }}\n      >\n        {/* @ts-expect-error: web-only prop */}\n        <View ref={setRef} onKeyDown={handleKeyDown} style={style} {...props}>\n          {children}\n        </View>\n      </RovingFocusContext.Provider>\n    )\n  },\n)\n\nRovingFocusGroup.displayName = \"RovingFocusGroup\"\n\nexport const RovingFocusItem = React.forwardRef<View, RovingFocusItemProps>(\n  ({ value, disabled, children, ...props }, ref) => {\n    const context = React.useContext(RovingFocusContext)\n    const isSelected = context?.value === value\n    // tabindex is 0 if selected (or no selection and first?), -1 otherwise\n    // Simpler: 0 if selected. If nothing selected, maybe first one?\n    // Usually Roving Focus ensures one item is always tabbable.\n    // If context.value is undefined, make the first one tabbable?\n    // For now, let's assume uncontrolled defaultValue is set or controlled value is set.\n    // If nothing set, user tabs in -> we might not catch focus.\n    // robust impl checks if any item is active.\n\n    const tabIndex = isSelected ? 0 : -1\n\n    return (\n      <View\n        ref={ref}\n        {...{ [ITEM_DATA_ATTR]: true, [VALUE_DATA_ATTR]: value }}\n        accessibilityRole=\"button\"\n        accessibilityState={{ disabled: !!disabled }}\n        focusable={!disabled}\n        // @ts-expect-error - Web-only prop\n        disabled={disabled}\n        tabIndex={disabled ? undefined : tabIndex}\n        {...props}\n      >\n        {children}\n      </View>\n    )\n  },\n)\n\nRovingFocusItem.displayName = \"RovingFocusItem\"\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/roving-focus/roving-focus.native.tsx",
      "content": "import * as React from \"react\"\nimport { View } from \"react-native\"\nimport type { RovingFocusGroupProps, RovingFocusItemProps } from \"./types.js\"\n\nexport const RovingFocusGroup = React.forwardRef<View, RovingFocusGroupProps>(\n  (props, ref) => {\n    return <View ref={ref} {...props} />\n  },\n)\nRovingFocusGroup.displayName = \"RovingFocusGroup\"\n\nexport const RovingFocusItem = React.forwardRef<View, RovingFocusItemProps>(\n  (props, ref) => {\n    return <View ref={ref} {...props} />\n  },\n)\nRovingFocusItem.displayName = \"RovingFocusItem\"\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/roving-focus/index.ts",
      "content": "export * from \"./roving-focus.js\"\nexport * from \"./types.js\"\n",
      "type": "registry:lib"
    }
  ]
}
