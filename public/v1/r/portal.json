{
  "name": "portal",
  "type": "registry:lib",
  "title": "Portal",
  "description": "Portal provider and host primitives for overlays.",
  "files": [
    {
      "path": "lib/portal/PortalProvider.tsx",
      "content": "import type React from \"react\"\nimport { createContext, useContext, useRef } from \"react\"\n\nimport { PortalStore } from \"./portal-store.js\"\n\nconst PortalStoreContext = createContext<PortalStore | null>(null)\n\nexport type PortalProviderProps = {\n  children: React.ReactNode\n}\n\nexport function PortalProvider({ children }: PortalProviderProps) {\n  const storeRef = useRef<PortalStore | null>(null)\n\n  if (!storeRef.current) {\n    storeRef.current = new PortalStore()\n  }\n\n  return <PortalStoreContext.Provider value={storeRef.current}>{children}</PortalStoreContext.Provider>\n}\n\nexport function usePortalStore(): PortalStore {\n  const store = useContext(PortalStoreContext)\n\n  if (!store) {\n    throw new Error(\"PortalProvider is missing. Wrap your app with <PortalProvider>.\")\n  }\n\n  return store\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/portal/PortalHost.tsx",
      "content": "import { Fragment, useSyncExternalStore } from \"react\"\nimport { StyleSheet, View, type ViewProps } from \"react-native\"\n\nimport { usePortalStore } from \"./PortalProvider.js\"\n\nexport type PortalHostProps = ViewProps & {\n  name?: string\n}\n\nconst DEFAULT_HOST_NAME = \"root\"\n\nconst styles = StyleSheet.create({\n  host: {\n    ...StyleSheet.absoluteFillObject,\n  },\n})\n\nexport function PortalHost({\n  name = DEFAULT_HOST_NAME,\n  pointerEvents,\n  style,\n  children,\n  ...props\n}: PortalHostProps) {\n  const store = usePortalStore()\n\n  const nodes = useSyncExternalStore(\n    store.subscribe,\n    () => store.getSnapshot(name),\n    () => store.getSnapshot(name),\n  )\n\n  return (\n    <View\n      pointerEvents={pointerEvents ?? \"box-none\"}\n      style={[styles.host, style]}\n      {...props}\n    >\n      {children}\n      {nodes.map((entry) => (\n        <Fragment key={entry.key}>{entry.node}</Fragment>\n      ))}\n    </View>\n  )\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/portal/Portal.tsx",
      "content": "import type React from \"react\"\nimport { useEffect, useRef } from \"react\"\n\nimport { usePortalStore } from \"./PortalProvider.js\"\n\nexport type PortalProps = {\n  name?: string\n  children: React.ReactNode\n}\n\nlet portalKey = 0\n\nexport function Portal({ name = \"root\", children }: PortalProps) {\n  const store = usePortalStore()\n  const keyRef = useRef<number>(0)\n  const childrenRef = useRef(children)\n  childrenRef.current = children\n\n  if (keyRef.current === 0) {\n    portalKey += 1\n    keyRef.current = portalKey\n  }\n\n  useEffect(() => {\n    store.mount(name, keyRef.current, childrenRef.current)\n\n    return () => {\n      store.unmount(name, keyRef.current)\n    }\n  }, [store, name])\n\n  useEffect(() => {\n    store.update(name, keyRef.current, children)\n  }, [store, name, children])\n\n  return null\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/portal/portal-store.ts",
      "content": "import type { ReactNode } from \"react\"\n\nexport type PortalNode = {\n  key: number\n  node: ReactNode\n}\n\nexport class PortalStore {\n  private hosts = new Map<string, Map<number, ReactNode>>()\n  private listeners = new Set<() => void>()\n\n  subscribe = (listener: () => void): (() => void) => {\n    this.listeners.add(listener)\n    return () => {\n      this.listeners.delete(listener)\n    }\n  }\n\n  getSnapshot(name: string): PortalNode[] {\n    const host = this.hosts.get(name)\n    if (!host) {\n      return []\n    }\n\n    return Array.from(host.entries()).map(([key, node]) => ({ key, node }))\n  }\n\n  mount(name: string, key: number, node: ReactNode): void {\n    const host = this.ensureHost(name)\n    const hadEntry = host.has(key)\n    const prev = host.get(key)\n    host.set(key, node)\n\n    if (!hadEntry || prev !== node) {\n      this.notify()\n    }\n  }\n\n  update(name: string, key: number, node: ReactNode): void {\n    const host = this.ensureHost(name)\n    const prev = host.get(key)\n\n    if (prev !== node) {\n      host.set(key, node)\n      this.notify()\n    }\n  }\n\n  unmount(name: string, key: number): void {\n    const host = this.hosts.get(name)\n    if (!host) {\n      return\n    }\n\n    const removed = host.delete(key)\n    if (host.size === 0) {\n      this.hosts.delete(name)\n    }\n\n    if (removed) {\n      this.notify()\n    }\n  }\n\n  private ensureHost(name: string): Map<number, ReactNode> {\n    const existing = this.hosts.get(name)\n    if (existing) {\n      return existing\n    }\n\n    const created = new Map<number, ReactNode>()\n    this.hosts.set(name, created)\n    return created\n  }\n\n  private notify(): void {\n    if (this.listeners.size === 0) {\n      return\n    }\n\n    for (const listener of Array.from(this.listeners)) {\n      listener()\n    }\n  }\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "lib/portal/index.ts",
      "content": "export { Portal } from \"./Portal.js\"\nexport type { PortalProps } from \"./Portal.js\"\nexport { PortalHost } from \"./PortalHost.js\"\nexport type { PortalHostProps } from \"./PortalHost.js\"\nexport { PortalProvider } from \"./PortalProvider.js\"\nexport type { PortalProviderProps } from \"./PortalProvider.js\"\n",
      "type": "registry:lib"
    }
  ]
}
